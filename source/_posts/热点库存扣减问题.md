---
tags: [面试题]   
categories: [redis]
---

常见的秒杀场景是一个相对简单的热点库存扣减问题，因为扣减的库存量不大。更加典型的
热点库存扣减问题是春节红包雨，同一个资金池数亿人抢红包。对于春节红包雨介绍两种方
案：

### 方案一

> 存在消耗不均问题：不同分桶之间，库存消耗不均，可能导致部分用户无法扣减库存，但
> 其他用户可扣减库存，从而引发用户投诉。

![图片](https://gitee.com/zhaojinxin_golden/article-images/raw/master/typora/640-20220911201150925.png)

### 方案二

> 小量多次地分派库存，从而缓解分桶库存消耗不均问题。

![图片](https://gitee.com/zhaojinxin_golden/article-images/raw/master/typora/640-20220911201131227.png)

此外，将用户进入的时间打散，减少瞬时请求峰值，也是一个很好的技术思路。

### 设计反思

Q1：为何用定时任务调度主动分配库存，而不是在分桶库存不足时被动拉库存？答：因为主
动分配库存 QPS 比被动拉库存低几个量级。

Q2：Redis 库存总池为何不用某个 master 机器维护，而用定时任务调度随机挑选机器？答
：防单点。

Q2：如何应对超大流量？答：流量不触达 DB、分桶、打散。
