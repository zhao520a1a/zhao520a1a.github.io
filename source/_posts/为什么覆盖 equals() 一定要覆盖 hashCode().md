
---
tags: [map]    
categories: [æ•°æ®å­˜å‚¨] 
---

[TOC]
> å¦‚æœä¸è¿™æ ·åšçš„è¯ï¼Œå°±ä¼šè¿å hashCode çš„é€šç”¨çº¦å®š,ï¼ˆç›¸ç­‰çš„å¯¹è±¡å¿…é¡»æ‹¥æœ‰ç›¸åŒçš„ hashCode æ•£åˆ—å€¼ï¼‰ï¼Œä»è€Œ`å¯¼è‡´è¯¥ç±»æ— æ³•åŒæ‰€æœ‰çš„ç»™äºˆæ•£åˆ—çš„é›†åˆä¸€èµ·æ­£å¸¸è¿ä½œ`ã€‚è¿™ç±»é›†åˆåŒ…æ‹¬ HashSetã€HashMapã€‚
 
 
#### å¯¼è‡´é—®é¢˜
ä¸¾ä¸ªğŸŒ°:
``` java
public class PhoneNumber {
    int numbersOne;
    int numbersTwo;
    int numbersThree;
    public PhoneNumber(int numbersOne, int numbersTwo, int numbersThree) {
        this.numbersOne = numbersOne;
        this.numbersTwo = numbersTwo;
        this.numbersThree = numbersThree;
    }
    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (!(o instanceof PhoneNumber)) return false;
        PhoneNumber that = (PhoneNumber) o;
        return Objects.equals(numbersOne, that.numbersOne) &&
                Objects.equals(numbersTwo, that.numbersTwo) &&
                Objects.equals(numbersThree, that.numbersThree);
    }
    public static void main(String[] args) {
        Map numberMap = new HashMap();
        numberMap.put(new PhoneNumber(707,867,5309),"Jenny");
        System.out.println(numberMap.get(new PhoneNumber(707,867,5309)));
    }
}
```

æ­¤æ—¶ï¼Œä½ å¯èƒ½å¸Œæœ› numberMap.get(new PhoneNumber(707,867,5309)) ä¼šè¿”å› "Jerry"ï¼Œä½†å®ƒå®é™…ä¸Šè¿”å›çš„æ˜¯null ã€‚è¿™é‡Œä¼šæ¶‰åŠåˆ°ä¸¤ä¸ªå®ä¾‹ï¼š<u>ç¬¬ä¸€ä¸ªå®ä¾‹æ˜¯ç¬¬ä¸€æ¬¡æ·»åŠ è¿›å…¥çš„ PhoneNumber , å®ƒä¼šè¢«æ·»åŠ åˆ°ä¸€ä¸ªæ¡¶ä¸­ã€‚å› ä¸ºæ²¡æœ‰é‡å†™ hashCode æ–¹æ³•ï¼Œæ‰€ä»¥ä½ å–çš„æ—¶å€™æ˜¯å»å¦å¤–ä¸€ä¸ªæ¡¶ä¸­å–å‡ºæ¥çš„ PhoneNumber å®ä¾‹,æ‰€ä»¥è‡ªç„¶ä¸¤ä¸ªå®ä¾‹ä¸ç›¸ç­‰ã€‚</u>å› ä¸º HashMap æœ‰ä¸€é¡¹ä¼˜åŒ–ï¼Œå¯ä»¥å°†ä¸æ¯ä¸ªé¡¹ç›¸å…³è”çš„æ•£åˆ—ç ç¼“å­˜èµ·æ¥ï¼Œ`å¦‚æœå¯¹è±¡æ•£åˆ—ç ä¸ç›¸ç­‰ï¼Œä¹Ÿå°±ä¸å†å»æ£€éªŒå¯¹è±¡çš„ç­‰åŒæ€§ã€‚`åœ¨æ·±å…¥çš„è¯´ï¼Œæ’å…¥æ—¶ä»¥å½“å‰å¯¹è±¡hashCodeåšä¸ºå­˜å‚¨ä½ç½®ä¾æ®ï¼ŒæŸ¥è¯¢æ—¶å› æ–°å¯¹è±¡hashCodeå€¼å’Œæ’å…¥æ—¶çš„å¯¹è±¡hashCodeå€¼ä¸ç›¸ç­‰ï¼Œå¯¼è‡´æ²¡æ³•æŸ¥æ‰¾çš„ä½ç½®ä¸å¯¹ï¼Œæ— æ³•æ­£ç¡®æ‰¾åˆ°å…ƒç´ ã€‚



ä¿®æ­£è¿™ä¸ªé—®é¢˜éå¸¸çš„ç®€å•ï¼Œåªè¦æä¾›ä¸€ä¸ªç›¸ç­‰çš„æ•£åˆ—ç å°±å¯ä»¥äº†ã€‚

ä¸‹é¢æ˜¯è§£å†³åŠæ³•ï¼š

#### æ–¹æ³•1
1. å£°æ˜ä¸€ä¸ª int å˜é‡å¹¶å‘½åä¸º resultï¼Œå°†å®ƒåˆå§‹åŒ–ä¸ºå¯¹è±¡ä¸­çš„ç¬¬ä¸€ä¸ªå…³é”®åŸŸæ•£åˆ—ç  c.
2. å¯¹è±¡ä¸­å‰©ä¸‹çš„æ¯ä¸€ä¸ªå…³é”®åŸŸ f éƒ½å®Œæˆä¸€ä¸‹æ­¥éª¤ï¼š
ä¸ºè¯¥åŸŸè®¡ç®— int ç±»å‹çš„æ•£åˆ—ç  c,ç„¶åæŒ‰ç…§ä¸‹é¢çš„å…¬å¼ï¼ŒæŠŠæ•£åˆ—ç  c åˆå¹¶åˆ° result ä¸­ã€‚
*result = 31 * result + c;*
â‘  å¦‚æœè¯¥åŸŸæ˜¯åŸºæœ¬ç±»å‹ï¼Œåˆ™è®¡ç®— Type.hashCode(f)ï¼Œè¿™é‡Œçš„ Type æ˜¯é›†è£…ç®±åŸºæœ¬ç±»å‹çš„ç±»ï¼Œä¸ f çš„ç±»å‹ç›¸å¯¹åº”
â‘¡ å¦‚æœè¯¥åŸŸæ˜¯ä¸€ä¸ªå¯¹è±¡å¼•ç”¨ï¼Œå¹¶ä¸”è¯¥ç±»çš„ equals æ–¹æ³•é€šè¿‡é€’å½’åœ°è°ƒç”¨ equals çš„æ–¹å¼æ¥æ¯”è¾ƒè¿™ä¸ªåŸŸï¼Œåˆ™åŒæ ·ä¸ºè¿™ä¸ªåŸŸé€’å½’åœ°è°ƒç”¨ hashCode ã€‚å¦‚æœä¸ºnull ï¼Œåˆ™è¿”å›0
â‘¢ å¦‚æœè¯¥åŸŸæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œåˆ™è¦æŠŠæ¯ä¸€ä¸ªå…ƒç´ å½“ä½œå•ç‹¬çš„åŸŸæ¥å¤„ç†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé€’å½’åœ°åº”ç”¨ä¸Šè¿°è§„åˆ™ï¼Œå¯¹æ¯ä¸ªé‡è¦çš„å…ƒç´ è®¡ç®—ä¸€ä¸ªæ•£åˆ—ç ï¼Œç„¶åæ ¹æ®æ­¥éª¤2 . bä¸­çš„åšæ³•æŠŠè¿™äº›æ•£åˆ—å€¼ç»„åˆèµ·æ¥ã€‚å¦‚æœæ•°ç»„åŸŸä¸­æ²¡æœ‰é‡è¦çš„å…ƒç´ ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå¸¸é‡ï¼Œä½†æœ€å¥½ä¸è¦ç”¨0ã€‚å¦‚æœæ•°ç»„åŸŸä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½å¾ˆé‡è¦ï¼Œå¯ä»¥ä½¿ç”¨ Arrays.hashCode æ–¹æ³•ã€‚
3. è¿”å›result


å†™å®Œäº†ä¹‹åï¼Œè¿˜è¦è¿›è¡ŒéªŒè¯ï¼Œç›¸ç­‰çš„å®ä¾‹æ˜¯å¦å…·æœ‰ç›¸åŒçš„æ•£åˆ—ç ï¼Œå¯ä»¥æŠŠä¸Šè¿°è§£å†³åŠæ³•ç”¨åˆ° PhoneNumber ä¸­ï¼š
``` java
@Override
public int hashCode() {
  int result = Integer.hashCode(numbersOne);
  result = 31 * result + Integer.hashCode(numbersTwo);
  result = 31 * result + Integer.hashCode(numbersThree);
  return result;
}
```

å¦‚æœä¸€ä¸ªç±»æ˜¯ä¸å¯å˜çš„ï¼Œå¹¶ä¸”è®¡ç®— hashCode çš„å¼€é”€ä¹Ÿå¤§ï¼Œé‚£ä¹ˆåº”è¯¥æŠŠå®ƒæ¢å­˜åœ¨å¯¹è±¡å†…éƒ¨ï¼Œè€Œä¸æ˜¯æ¯æ¬¡è¯·æ±‚éƒ½é‡æ–°åˆ›å»º hashCodeã€‚ä½ å¯ä»¥é€‰æ‹©`"å»¶è¿Ÿåˆå§‹åŒ–"` çš„æ•£åˆ—ç ã€‚å³ä¸€ç›´åˆ° hashCode è¢«ç¬¬ä¸€æ¬¡ä½¿ç”¨çš„æ—¶å€™è¿›è¡Œåˆå§‹åŒ–ã€‚å¦‚ä¸‹ï¼š
``` java
private int hashCode;
@Override
public int hashCode() {
  int result = hashCode;
  if(result == 0){
    result = Integer.hashCode(numbersOne);
    result = 31 * result + Integer.hashCode(numbersTwo);
    result = 31 * result + Integer.hashCode(numbersThree);
    hashCode = result;
  }
  return result;
}
```
è™½ç„¶ä¸Šè¿°ç»™å‡ºäº† hashCode å®ç°ï¼Œä½†å®ƒä¸æ˜¯æœ€å…ˆè¿›çš„ã€‚å®ƒä»¬çš„è´¨é‡å ªæ¯” Java å¹³å°ç±»åº“æä¾›çš„æ•£åˆ—å‡½æ•°ã€‚è¿™äº›æ–¹æ³•å¯¹äºå¤§å¤šæ•°åº”ç”¨ç¨‹åºè€Œè¨€å·²ç»è¶³å¤Ÿäº†ã€‚


#### æ–¹æ³•2
Objects ç±»æœ‰ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œå®ƒå¸¦æœ‰ä»»æ„æ•°é‡çš„å¯¹è±¡ï¼Œå¹¶ä¸ºå®ƒä»¬è¿”å›ä¸€ä¸ªæ•£åˆ—ç ã€‚è¿™ä¸ªæ–¹æ³•åä¸º hash ã€‚ä½ åªéœ€è¦ä¸€è¡Œä»£ç å°±å¯ä»¥ç¼–å†™å®ƒçš„ hashCode æ–¹æ³•ã€‚å®ƒä»¬çš„è´¨é‡ä¹Ÿæ˜¯å¾ˆé«˜çš„ï¼Œä½†æ˜¯ï¼Œå®ƒçš„è¿è¡Œé€Ÿåº¦ç›¸å¯¹æ…¢ä¸€äº›ï¼Œå› ä¸ºå®ƒä»¬ä¼šå¼•å‘æ•°ç»„çš„åˆ›å»ºï¼Œä»¥ä¾¿ä¼ å…¥æ•°ç›®å¯å˜çš„å‚æ•°ï¼Œå¦‚æœå‚æ•°ä¸­æœ‰åŸºæœ¬ç±»å‹ï¼Œè¿˜éœ€è¦è£…ç®±å’Œæ‹†ç®±ã€‚ä¾‹å¦‚ï¼š
``` java
@Override
public int hashCode(){
  return Objects.hash(numbersOne,numbersTwo,numbersThree);
}

```

#### æ–¹æ³•3
å¦‚æœä¸æƒ³é‚£ä¹ˆè´¹åŠ›ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ eclipse æˆ–è€… Idea æä¾›çš„ AutoValue è‡ªåŠ¨ç”Ÿæˆå°±å¯ä»¥äº†ã€‚


#### éµå®ˆé‡å†™çº¦å®š
å½“ä½ è¦é‡å†™å¯¹è±¡çš„ hashCode æ–¹æ³•æ—¶ï¼Œä¸‹é¢è¿™ä¸¤ä¸ªçº¦å®šæˆ‘å¸Œæœ›ä½ èƒ½éµå®ˆï¼š
* ä¸è¦å¯¹ hashCode æ–¹æ³•çš„è¿”å›å€¼åšå…·ä½“çš„è§„å®šï¼Œå› æ­¤å®¢æˆ·ç«¯æ— æ³•ç†æ‰€å½“ç„¶åœ°ä¾èµ–å®ƒï¼›è¿™æ ·å¯ä»¥ä¸ºä¿®æ”¹æä¾›çµæ´»æ€§ã€‚

* ä¸è¦è¯•å›¾ä»æ•£åˆ—ç è®¡ç®—ä¸­æ’é™¤æ‰ä¸€ä¸ªå¯¹è±¡çš„å…³é”®åŸŸæ¥æé«˜æ€§èƒ½ã€‚

 æ€»è€Œè¨€ä¹‹ï¼Œæ¯å½“è¦†ç›– equals æ–¹æ³•æ—¶éƒ½å¿…é¡»è¦†ç›– hashCodeã€‚å¦åˆ™ç¨‹åºå°†æ— æ³•æ­£ç¡®è¿è¡Œã€‚