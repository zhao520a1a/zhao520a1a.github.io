<!DOCTYPE html><html lang="zh-Hans" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>Go JSON 库调研 | 发光の金子吖</title><meta name="author" content="Golden"><meta name="copyright" content="Golden"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Go Json 编解码哪家强？">
<meta property="og:type" content="article">
<meta property="og:title" content="Go JSON 库调研">
<meta property="og:url" content="https://zhao520a1a.github.io/2023/04/09/%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86/Go%20JSON%20%E5%BA%93%E8%B0%83%E7%A0%94/index.html">
<meta property="og:site_name" content="发光の金子吖">
<meta property="og:description" content="Go Json 编解码哪家强？">
<meta property="og:locale">
<meta property="og:image" content="https://cdn.processon.com/643289818976261088dae76b?e=1681037201&token=trhI0BY8QfVrIGn9nENop6JAc6l5nZuxhjQ62UfM:7_9-iyaq39lLvAlJyPfFSQBbXxQ=">
<meta property="article:published_time" content="2023-04-08T16:00:00.000Z">
<meta property="article:modified_time" content="2023-04-11T14:54:08.623Z">
<meta property="article:author" content="Golden">
<meta property="article:tag" content="go">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.processon.com/643289818976261088dae76b?e=1681037201&token=trhI0BY8QfVrIGn9nENop6JAc6l5nZuxhjQ62UfM:7_9-iyaq39lLvAlJyPfFSQBbXxQ="><link rel="shortcut icon" href="/img/logo.png"><link rel="canonical" href="https://zhao520a1a.github.io/2023/04/09/%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86/Go%20JSON%20%E5%BA%93%E8%B0%83%E7%A0%94/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Go JSON 库调研',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-04-11 22:54:08'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.0.0-rc1"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">25</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.processon.com/643289818976261088dae76b?e=1681037201&amp;token=trhI0BY8QfVrIGn9nENop6JAc6l5nZuxhjQ62UfM:7_9-iyaq39lLvAlJyPfFSQBbXxQ=')"><nav id="nav"><span id="blog-info"><a href="/" title="发光の金子吖"><img class="site-icon" src="/img/logo.png"/><span class="site-name">发光の金子吖</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Go JSON 库调研</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-04-08T16:00:00.000Z" title="发表于 2023-04-09 00:00:00">2023-04-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-04-11T14:54:08.623Z" title="更新于 2023-04-11 22:54:08">2023-04-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86/">内部原理</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Go JSON 库调研"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><p>Go 标准库 <a target="_blank" rel="noopener" href="https://pkg.go.dev/encoding/json">encoding&#x2F;json</a> 已经是提供了足够舒适的 JSON 处理工具，广受 Go 开发者的好评。它还能有什么问题？什么情况下使用第三方库？有哪些热门的三方库？如何选型？性能如何？</p>
<table>
<thead>
<tr>
<th>专业术语</th>
<th>名词解释</th>
</tr>
</thead>
<tbody><tr>
<td>Sonic</td>
<td>字节开源的高性能的 JSON 库</td>
</tr>
<tr>
<td>Sonnet</td>
<td>个人开发开发 JSON 库， ps:宣称比 Sonic 性能还高</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td>asm(Assembly language)</td>
<td>汇编语言</td>
</tr>
<tr>
<td>Plan9</td>
<td>Go 底层使用的汇编是 plan9 汇编，plan9 是一个全新的 Unix 系统</td>
</tr>
<tr>
<td>ast(Abstract Syntax Tree)</td>
<td>抽象语法树</td>
</tr>
<tr>
<td>SIMD(Single-Instruction-Multi-Data)</td>
<td>单指令流多数据流，一组特殊的 CPU 指令，用于矢量数据的并行处理。</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td>lazy-load</td>
<td>按需加载</td>
</tr>
<tr>
<td>buffer-reuse</td>
<td>复用缓存区</td>
</tr>
<tr>
<td>JIT</td>
<td>即时编译</td>
</tr>
<tr>
<td>code-gen</td>
<td>代码生成</td>
</tr>
<tr>
<td>Clang</td>
<td>一个 C&#x2F;C++&#x2F;Objective C&#x2F;Objective C++的轻量级编译器</td>
</tr>
</tbody></table>
<h2 id="你真的了解-JSON-处理吗？"><a href="#你真的了解-JSON-处理吗？" class="headerlink" title="你真的了解 JSON 处理吗？"></a>你真的了解 JSON 处理吗？</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s <span class="type">string</span></span><br><span class="line">err := json.Unmarshal([]<span class="type">byte</span>(<span class="string">`&quot;Hello, world!&quot;`</span>), &amp;s)</span><br><span class="line">assert.NoError(t, err)</span><br><span class="line">fmt.Println(s)</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cert := <span class="keyword">struct</span> &#123;</span><br><span class="line">	Username <span class="type">string</span> <span class="string">`json:&quot;username&quot;`</span></span><br><span class="line">	Password <span class="type">string</span> <span class="string">`json:&quot;password&quot;`</span></span><br><span class="line">&#125;&#123;&#125;</span><br><span class="line">err = json.Unmarshal([]<span class="type">byte</span>(<span class="string">`&#123;&quot;UserName&quot;:&quot;root&quot;,&quot;passWord&quot;:&quot;123456&quot;&#125;`</span>), &amp;cert)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;err =&quot;</span>, err)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;username =&quot;</span>, cert.Username)</span><br><span class="line">	fmt.Println(<span class="string">&quot;password =&quot;</span>, cert.Password)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试 Demo：<a target="_blank" rel="noopener" href="https://gitpod.io/#https://github.com/zhao520a1a/go-base">https://gitpod.io/#https://github.com/zhao520a1a/go-base</a></p>
<h2 id="标准库有什么问题？"><a href="#标准库有什么问题？" class="headerlink" title="标准库有什么问题？"></a>标准库有什么问题？</h2><p>Go JSON 标准库大量使用反射获取值，首先 Go 的反射本身性能较差，较耗费 CPU 配置；其次频繁分配对象，也会带来内存分配和 GC 的开销；同时没有提供按需加载机制，出于<strong>适用服务场景和降本收益的需求。</strong></p>
<h1 id="调研思路"><a href="#调研思路" class="headerlink" title="调研思路"></a>调研思路</h1><h2 id="评判标准"><a href="#评判标准" class="headerlink" title="评判标准"></a>评判标准</h2><p>性能方面，json 导致的 GC 与 CPU 压力较大，如：是否使用反射；</p>
<p>功能灵活性：是否支持 Unmarshal 到 map 或 struct，是否提供的一些定制化抽取的 API；</p>
<p>稳定性：业务较为重要，需要一个稳定的序列化库；</p>
<h2 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h2><p>根据主流 JSON 库 API，将它们的使用方式分为三种：</p>
<p><strong>泛型（generic）编解码</strong>：JSON 没有对应的 schema，只能依据自描述语义将读取到的 value 解释为对应语言的运行时对象，例如：JSON object 转化为 Go map[string]interface{}；</p>
<p><strong>定型（binding）编解码</strong>：JSON 有对应的 schema，可以同时结合模型定义（Go struct）与 JSON 语法，将读取到的 value 绑定到对应的模型字段上去，同时完成数据解析与校验；</p>
<p><strong>查找（get）&amp; 修改（set）</strong>：指定某种规则的查找路径（一般是 key 与 index 的集合），获取需要的那部分 JSON value 并处理。</p>
<h1 id="测试三方库"><a href="#测试三方库" class="headerlink" title="测试三方库"></a>测试三方库</h1><table>
<thead>
<tr>
<th><strong>库名</strong></th>
<th><strong>Star</strong></th>
<th><strong>encoder</strong></th>
<th><strong>decoder</strong></th>
<th><strong>compatible with</strong> <strong>encoding&#x2F;json</strong></th>
</tr>
</thead>
<tbody><tr>
<td>StdLib：<a target="_blank" rel="noopener" href="https://pkg.go.dev/encoding/json">encoding&#x2F;json</a></td>
<td>-</td>
<td>✔️</td>
<td>✔️</td>
<td>N&#x2F;A</td>
</tr>
<tr>
<td>FastJson：<a target="_blank" rel="noopener" href="https://github.com/valyala/fastjson">valyala&#x2F;fastjson</a></td>
<td>1.8k</td>
<td>✔️</td>
<td>✔️</td>
<td>❌</td>
</tr>
<tr>
<td>GJson：<a target="_blank" rel="noopener" href="https://github.com/tidwall/gjson">tidwall&#x2F;gjson</a></td>
<td>11.8k</td>
<td>✔️</td>
<td>✔️</td>
<td>❌</td>
</tr>
<tr>
<td>JsonParser：<a target="_blank" rel="noopener" href="https://github.com/buger/jsonparser">buger&#x2F;jsonparser</a></td>
<td>5k</td>
<td>✔️</td>
<td>✔️</td>
<td>❌</td>
</tr>
<tr>
<td>JsonIter：<a target="_blank" rel="noopener" href="https://github.com/json-iterator/go">json-iterator&#x2F;go</a></td>
<td>11.9k</td>
<td>✔️</td>
<td>✔️</td>
<td>部分兼容</td>
</tr>
<tr>
<td>GoJson：<a target="_blank" rel="noopener" href="https://github.com/goccy/go-json">goccy&#x2F;go-json</a></td>
<td>2.1k</td>
<td>✔️</td>
<td>✔️</td>
<td>✔️</td>
</tr>
<tr>
<td>EasyJson：<a target="_blank" rel="noopener" href="https://github.com/mailru/easyjson">mailru&#x2F;easyjson</a></td>
<td>4.1k</td>
<td>✔️</td>
<td>✔️</td>
<td>❌</td>
</tr>
<tr>
<td>Sonic：<a target="_blank" rel="noopener" href="https://github.com/bytedance/sonic">bytedance&#x2F;sonic</a></td>
<td>4.1k</td>
<td>✔️</td>
<td>✔️</td>
<td>✔️</td>
</tr>
<tr>
<td>Sonnet：<a target="_blank" rel="noopener" href="https://github.com/sugawarayuuta/sonnet">sugawarayuuta&#x2F;sonnet</a></td>
<td>20</td>
<td>❌</td>
<td>✔️</td>
<td>部分兼容</td>
</tr>
</tbody></table>
<h2 id="功能对比"><a href="#功能对比" class="headerlink" title="功能对比"></a>功能对比</h2><table>
<thead>
<tr>
<th><strong>相关库</strong></th>
<th>unmarshal (interface)</th>
<th>unmarshal (struct)</th>
<th>get&amp;set</th>
<th>stream</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>StdLib</td>
<td>✔️</td>
<td>✔️</td>
<td>❌</td>
<td>✔️</td>
<td></td>
</tr>
<tr>
<td>FastJson</td>
<td>❌</td>
<td>❌</td>
<td>✔️</td>
<td>❌</td>
<td>通过遍历 JSON 字符串的字节来挨个解析,返回其值 []byte，由业务方自行处理，牺牲了一定的兼容性，但功能上各有特色。fastjson 的 api 操作最简单；gjson 提供了模糊查找的功能，自定义程度最高；jsonparser 在实现高性能的解析过程中，还可以插入回调函数执行，提供了一定程度上的便利；</td>
</tr>
<tr>
<td>Gjson</td>
<td>✔️</td>
<td>❌</td>
<td>✔️</td>
<td>❌</td>
<td></td>
</tr>
<tr>
<td>JsonParser</td>
<td>❌</td>
<td>❌</td>
<td>✔️</td>
<td>❌</td>
<td></td>
</tr>
<tr>
<td>EasyJson</td>
<td>-</td>
<td>✔️</td>
<td>-</td>
<td>-</td>
<td>不使用反射通过代码生成的方式，类似 protobuf 为每一个结构体生成序列化的代码，具有强入侵性</td>
</tr>
<tr>
<td>JsonIter</td>
<td>✔️</td>
<td>❌</td>
<td>✔️</td>
<td>✔️</td>
<td>尽量减少反射的使用，eg：同一类型的对象，只调用 reflect 解析一次之后即缓存下来。尽量减少不必要的内存分配与复制</td>
</tr>
<tr>
<td>GoJson</td>
<td>✔️</td>
<td>✔️</td>
<td>❌</td>
<td>✔️</td>
<td></td>
</tr>
<tr>
<td>Sonic</td>
<td>✔️</td>
<td>✔️</td>
<td>✔️</td>
<td>✔️</td>
<td></td>
</tr>
<tr>
<td>Sonnet</td>
<td>✔️</td>
<td>✔️</td>
<td>❌</td>
<td>❌</td>
<td></td>
</tr>
</tbody></table>
<p><strong>为什么不推荐当前使用最广泛的第三方库 jsoniter？</strong></p>
<p>Go 1.8 之前，官方 json 库的性能就收到多方诟病。不过随着 go 版本的迭代，标准 json 库的性能也越来越高，jsonter 的性能优势也越来越窄。如果希望有极致的性能，应该选择 easyjson 等方案而不是 jsoniter，而且 jsoniter 近年已经不活跃了。</p>
<h2 id="性能对比"><a href="#性能对比" class="headerlink" title="性能对比"></a>性能对比</h2><p>涉及的测试数据&amp;测试方法，详情参见：<a target="_blank" rel="noopener" href="https://github.com/zhao520a1a/go-base/blob/master/json/benchmark_test/bench.sh">https://github.com/zhao520a1a/go-base/blob/master/json/benchmark_test/bench.sh</a></p>
<table>
<thead>
<tr>
<th><strong>库名</strong></th>
<th><strong>version</strong></th>
</tr>
</thead>
<tbody><tr>
<td>StdLib</td>
<td>v1.19</td>
</tr>
<tr>
<td>Sjson</td>
<td>v1.2.5</td>
</tr>
<tr>
<td>GJson</td>
<td>v1.14.4</td>
</tr>
<tr>
<td>JsonIter</td>
<td>v1.1.13</td>
</tr>
<tr>
<td>GoJson</td>
<td>v0.10.1</td>
</tr>
<tr>
<td>Sonic</td>
<td>v1.8.3</td>
</tr>
<tr>
<td>Sonnet</td>
<td>v0.0.0-20230211095525-cfcf1c3a9fc4</td>
</tr>
</tbody></table>
<p>根据样本 JSON 的 key 数量和深度分为三个量级：</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://github.com/zhao520a1a/go-base/blob/master/json/testdata/small.go">Small</a> (400B, 11 keys, 3 layers)</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/zhao520a1a/go-base/blob/master/json/testdata/medium.go">Medium</a> (13KB, 300+ key, 6 layers)</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/zhao520a1a/go-base/blob/master/json/testdata/large.json">Large</a> (635KB, 10000+ key, 6 layers)</p>
</li>
</ul>
<h3 id="解析小-JSON-字符串"><a href="#解析小-JSON-字符串" class="headerlink" title="解析小 JSON 字符串"></a>解析小 JSON 字符串</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">BenchmarkDecoder_Generic_StdLib<span class="number">-12</span>                       <span class="number">1000000</span>              <span class="number">6986</span> ns/op          <span class="number">52.25</span> MB/s        <span class="number">3474</span> B/op         <span class="number">91</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Generic_JsonIter<span class="number">-12</span>                     <span class="number">1000000</span>              <span class="number">7366</span> ns/op          <span class="number">49.55</span> MB/s        <span class="number">3748</span> B/op        <span class="number">112</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Generic_GoJson<span class="number">-12</span>                       <span class="number">1000000</span>              <span class="number">6961</span> ns/op          <span class="number">52.43</span> MB/s        <span class="number">4279</span> B/op        <span class="number">105</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Generic_Sonic<span class="number">-12</span>                        <span class="number">1000000</span>              <span class="number">4093</span> ns/op          <span class="number">89.17</span> MB/s        <span class="number">4567</span> B/op         <span class="number">42</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Generic_Sonic_V1<span class="number">-12</span>                     <span class="number">1000000</span>              <span class="number">4474</span> ns/op          <span class="number">81.58</span> MB/s        <span class="number">4363</span> B/op         <span class="number">71</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Generic_Sonic_Fast<span class="number">-12</span>                   <span class="number">1000000</span>              <span class="number">3927</span> ns/op          <span class="number">92.95</span> MB/s        <span class="number">4171</span> B/op         <span class="number">41</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Generic_Sonnet<span class="number">-12</span>                       <span class="number">1000000</span>              <span class="number">4743</span> ns/op          <span class="number">76.95</span> MB/s        <span class="number">3330</span> B/op         <span class="number">80</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Generic_StdLib<span class="number">-12</span>              <span class="number">1000000</span>              <span class="number">2387</span> ns/op         <span class="number">152.89</span> MB/s        <span class="number">3474</span> B/op         <span class="number">91</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Generic_JsonIter<span class="number">-12</span>            <span class="number">1000000</span>              <span class="number">2411</span> ns/op         <span class="number">151.37</span> MB/s        <span class="number">3749</span> B/op        <span class="number">112</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Generic_GoJson<span class="number">-12</span>              <span class="number">1000000</span>              <span class="number">2680</span> ns/op         <span class="number">136.20</span> MB/s        <span class="number">4283</span> B/op        <span class="number">105</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Generic_Sonic<span class="number">-12</span>               <span class="number">1000000</span>              <span class="number">1641</span> ns/op         <span class="number">222.45</span> MB/s        <span class="number">4615</span> B/op         <span class="number">42</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Generic_Sonic_V1<span class="number">-12</span>            <span class="number">1000000</span>              <span class="number">1707</span> ns/op         <span class="number">213.82</span> MB/s        <span class="number">4383</span> B/op         <span class="number">71</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Generic_Sonic_Fast<span class="number">-12</span>          <span class="number">1000000</span>              <span class="number">1688</span> ns/op         <span class="number">216.22</span> MB/s        <span class="number">4190</span> B/op         <span class="number">41</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Generic_Sonnet<span class="number">-12</span>              <span class="number">1000000</span>              <span class="number">2154</span> ns/op         <span class="number">169.45</span> MB/s        <span class="number">3331</span> B/op         <span class="number">80</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Binding_StdLib<span class="number">-12</span>                       <span class="number">1000000</span>              <span class="number">7369</span> ns/op          <span class="number">49.53</span> MB/s        <span class="number">1056</span> B/op         <span class="number">36</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Binding_JsonIter<span class="number">-12</span>                     <span class="number">1000000</span>              <span class="number">2281</span> ns/op         <span class="number">160.01</span> MB/s         <span class="number">688</span> B/op         <span class="number">31</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Binding_GoJson<span class="number">-12</span>                       <span class="number">1000000</span>              <span class="number">1786</span> ns/op         <span class="number">204.36</span> MB/s         <span class="number">939</span> B/op         <span class="number">19</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Binding_Sonic<span class="number">-12</span>                        <span class="number">1000000</span>              <span class="number">1697</span> ns/op         <span class="number">215.14</span> MB/s        <span class="number">1797</span> B/op          <span class="number">8</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Binding_Sonic_V1<span class="number">-12</span>                     <span class="number">1000000</span>              <span class="number">1720</span> ns/op         <span class="number">212.23</span> MB/s        <span class="number">1464</span> B/op         <span class="number">14</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Binding_Sonic_Fast<span class="number">-12</span>                   <span class="number">1000000</span>              <span class="number">1616</span> ns/op         <span class="number">225.85</span> MB/s        <span class="number">1403</span> B/op          <span class="number">7</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Binding_Sonnet<span class="number">-12</span>                       <span class="number">1000000</span>              <span class="number">4747</span> ns/op          <span class="number">76.89</span> MB/s        <span class="number">3330</span> B/op         <span class="number">80</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Binding_StdLib<span class="number">-12</span>              <span class="number">1000000</span>              <span class="number">1835</span> ns/op         <span class="number">198.92</span> MB/s        <span class="number">1055</span> B/op         <span class="number">36</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Binding_JsonIter<span class="number">-12</span>            <span class="number">1000000</span>               <span class="number">638.5</span> ns/op       <span class="number">571.62</span> MB/s         <span class="number">688</span> B/op         <span class="number">31</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Binding_GoJson<span class="number">-12</span>              <span class="number">1000000</span>               <span class="number">640.7</span> ns/op       <span class="number">569.68</span> MB/s         <span class="number">942</span> B/op         <span class="number">19</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Binding_Sonic<span class="number">-12</span>               <span class="number">1000000</span>               <span class="number">557.6</span> ns/op       <span class="number">654.64</span> MB/s        <span class="number">1868</span> B/op          <span class="number">8</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Binding_Sonic_V1<span class="number">-12</span>            <span class="number">1000000</span>               <span class="number">523.6</span> ns/op       <span class="number">697.05</span> MB/s        <span class="number">1496</span> B/op         <span class="number">14</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Binding_Sonic_Fast<span class="number">-12</span>          <span class="number">1000000</span>               <span class="number">504.4</span> ns/op       <span class="number">723.67</span> MB/s        <span class="number">1436</span> B/op          <span class="number">7</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Binding_Sonnet<span class="number">-12</span>              <span class="number">1000000</span>               <span class="number">718.4</span> ns/op       <span class="number">508.06</span> MB/s         <span class="number">751</span> B/op         <span class="number">17</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Generic_StdLib<span class="number">-12</span>                       <span class="number">1000000</span>             <span class="number">10142</span> ns/op          <span class="number">35.99</span> MB/s        <span class="number">3273</span> B/op         <span class="number">67</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Generic_JsonIter<span class="number">-12</span>                     <span class="number">1000000</span>              <span class="number">5373</span> ns/op          <span class="number">67.93</span> MB/s        <span class="number">1024</span> B/op         <span class="number">16</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Generic_GoJson<span class="number">-12</span>                       <span class="number">1000000</span>              <span class="number">4903</span> ns/op          <span class="number">74.44</span> MB/s         <span class="number">961</span> B/op          <span class="number">2</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Generic_Sonic<span class="number">-12</span>                        <span class="number">1000000</span>              <span class="number">2405</span> ns/op         <span class="number">151.76</span> MB/s         <span class="number">479</span> B/op          <span class="number">4</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Generic_Sonic_V1<span class="number">-12</span>                     <span class="number">1000000</span>              <span class="number">2734</span> ns/op         <span class="number">133.49</span> MB/s         <span class="number">732</span> B/op          <span class="number">4</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Generic_Sonic_Fast<span class="number">-12</span>                   <span class="number">1000000</span>              <span class="number">2329</span> ns/op         <span class="number">156.72</span> MB/s         <span class="number">469</span> B/op          <span class="number">4</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Generic_Sonic<span class="number">-12</span>               <span class="number">1000000</span>               <span class="number">475.6</span> ns/op       <span class="number">767.50</span> MB/s         <span class="number">487</span> B/op          <span class="number">4</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Generic_JsonIter<span class="number">-12</span>            <span class="number">1000000</span>              <span class="number">1248</span> ns/op         <span class="number">292.50</span> MB/s        <span class="number">1024</span> B/op         <span class="number">16</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Generic_GoJson<span class="number">-12</span>              <span class="number">1000000</span>              <span class="number">1636</span> ns/op         <span class="number">223.16</span> MB/s         <span class="number">961</span> B/op          <span class="number">2</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Generic_StdLib<span class="number">-12</span>              <span class="number">1000000</span>              <span class="number">3971</span> ns/op          <span class="number">91.92</span> MB/s        <span class="number">3273</span> B/op         <span class="number">67</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Generic_Sonic_V1<span class="number">-12</span>            <span class="number">1000000</span>              <span class="number">1003</span> ns/op         <span class="number">363.81</span> MB/s         <span class="number">760</span> B/op          <span class="number">4</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Generic_Sonic_Fast<span class="number">-12</span>          <span class="number">1000000</span>               <span class="number">537.9</span> ns/op       <span class="number">678.51</span> MB/s         <span class="number">492</span> B/op          <span class="number">4</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Binding_StdLib<span class="number">-12</span>                       <span class="number">1000000</span>              <span class="number">2073</span> ns/op         <span class="number">176.07</span> MB/s         <span class="number">384</span> B/op          <span class="number">1</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Binding_JsonIter<span class="number">-12</span>                     <span class="number">1000000</span>              <span class="number">2209</span> ns/op         <span class="number">165.26</span> MB/s         <span class="number">392</span> B/op          <span class="number">2</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Binding_GoJson<span class="number">-12</span>                       <span class="number">1000000</span>              <span class="number">1172</span> ns/op         <span class="number">311.31</span> MB/s         <span class="number">384</span> B/op          <span class="number">1</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Binding_Sonic<span class="number">-12</span>                        <span class="number">1000000</span>               <span class="number">842.2</span> ns/op       <span class="number">433.41</span> MB/s         <span class="number">492</span> B/op          <span class="number">4</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Binding_Sonic_V1<span class="number">-12</span>                     <span class="number">1000000</span>               <span class="number">956.8</span> ns/op       <span class="number">381.50</span> MB/s         <span class="number">757</span> B/op          <span class="number">4</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Binding_Sonic_Fast<span class="number">-12</span>                   <span class="number">1000000</span>               <span class="number">814.0</span> ns/op       <span class="number">448.41</span> MB/s         <span class="number">490</span> B/op          <span class="number">4</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Binding_StdLib<span class="number">-12</span>              <span class="number">1000000</span>               <span class="number">452.7</span> ns/op       <span class="number">806.23</span> MB/s         <span class="number">384</span> B/op          <span class="number">1</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Binding_JsonIter<span class="number">-12</span>            <span class="number">1000000</span>               <span class="number">508.1</span> ns/op       <span class="number">718.34</span> MB/s         <span class="number">392</span> B/op          <span class="number">2</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Binding_GoJson<span class="number">-12</span>              <span class="number">1000000</span>               <span class="number">331.9</span> ns/op      <span class="number">1099.89</span> MB/s         <span class="number">384</span> B/op          <span class="number">1</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Binding_Sonic<span class="number">-12</span>               <span class="number">1000000</span>               <span class="number">184.7</span> ns/op      <span class="number">1976.14</span> MB/s         <span class="number">488</span> B/op          <span class="number">4</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Binding_Sonic_V1<span class="number">-12</span>            <span class="number">1000000</span>               <span class="number">238.7</span> ns/op      <span class="number">1529.08</span> MB/s         <span class="number">745</span> B/op          <span class="number">4</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Binding_Sonic_Fast<span class="number">-12</span>          <span class="number">1000000</span>               <span class="number">185.8</span> ns/op      <span class="number">1964.13</span> MB/s         <span class="number">496</span> B/op          <span class="number">4</span> allocs/op</span><br></pre></td></tr></table></figure>

<h3 id="解析中-JSON-字符串"><a href="#解析中-JSON-字符串" class="headerlink" title="解析中 JSON 字符串"></a>解析中 JSON 字符串</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">BenchmarkDecoder_Generic_StdLib<span class="number">-12</span>                        <span class="number">100000</span>            <span class="number">134048</span> ns/op          <span class="number">97.26</span> MB/s       <span class="number">50870</span> B/op        <span class="number">772</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Generic_JsonIter<span class="number">-12</span>                      <span class="number">100000</span>             <span class="number">94131</span> ns/op         <span class="number">138.50</span> MB/s       <span class="number">55779</span> B/op       <span class="number">1068</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Generic_GoJson<span class="number">-12</span>                        <span class="number">100000</span>             <span class="number">91549</span> ns/op         <span class="number">142.40</span> MB/s       <span class="number">66358</span> B/op        <span class="number">973</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Generic_Sonic<span class="number">-12</span>                         <span class="number">100000</span>             <span class="number">57213</span> ns/op         <span class="number">227.87</span> MB/s       <span class="number">62757</span> B/op        <span class="number">314</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Generic_Sonic_V1<span class="number">-12</span>                      <span class="number">100000</span>             <span class="number">67120</span> ns/op         <span class="number">194.23</span> MB/s       <span class="number">56800</span> B/op        <span class="number">723</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Generic_Sonic_Fast<span class="number">-12</span>                    <span class="number">100000</span>             <span class="number">54601</span> ns/op         <span class="number">238.77</span> MB/s       <span class="number">49020</span> B/op        <span class="number">313</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Generic_Sonnet<span class="number">-12</span>                        <span class="number">100000</span>             <span class="number">67423</span> ns/op         <span class="number">193.36</span> MB/s       <span class="number">50222</span> B/op        <span class="number">739</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Generic_StdLib<span class="number">-12</span>               <span class="number">100000</span>             <span class="number">50068</span> ns/op         <span class="number">260.38</span> MB/s       <span class="number">50875</span> B/op        <span class="number">772</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Generic_JsonIter<span class="number">-12</span>             <span class="number">100000</span>             <span class="number">38097</span> ns/op         <span class="number">342.20</span> MB/s       <span class="number">55790</span> B/op       <span class="number">1068</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Generic_GoJson<span class="number">-12</span>               <span class="number">100000</span>             <span class="number">33294</span> ns/op         <span class="number">391.57</span> MB/s       <span class="number">66364</span> B/op        <span class="number">974</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Generic_Sonic<span class="number">-12</span>                <span class="number">100000</span>             <span class="number">21363</span> ns/op         <span class="number">610.25</span> MB/s       <span class="number">63889</span> B/op        <span class="number">314</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Generic_Sonic_V1<span class="number">-12</span>             <span class="number">100000</span>             <span class="number">24666</span> ns/op         <span class="number">528.55</span> MB/s       <span class="number">56823</span> B/op        <span class="number">723</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Generic_Sonic_Fast<span class="number">-12</span>           <span class="number">100000</span>             <span class="number">19639</span> ns/op         <span class="number">663.84</span> MB/s       <span class="number">49063</span> B/op        <span class="number">313</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Generic_Sonnet<span class="number">-12</span>               <span class="number">100000</span>             <span class="number">33211</span> ns/op         <span class="number">392.55</span> MB/s       <span class="number">50233</span> B/op        <span class="number">739</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Binding_StdLib<span class="number">-12</span>                        <span class="number">100000</span>            <span class="number">119862</span> ns/op         <span class="number">108.77</span> MB/s       <span class="number">10576</span> B/op        <span class="number">208</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Binding_JsonIter<span class="number">-12</span>                      <span class="number">100000</span>             <span class="number">37648</span> ns/op         <span class="number">346.29</span> MB/s       <span class="number">14672</span> B/op        <span class="number">385</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Binding_GoJson<span class="number">-12</span>                        <span class="number">100000</span>             <span class="number">30700</span> ns/op         <span class="number">424.66</span> MB/s       <span class="number">22031</span> B/op         <span class="number">49</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Binding_Sonic<span class="number">-12</span>                         <span class="number">100000</span>             <span class="number">31562</span> ns/op         <span class="number">413.05</span> MB/s       <span class="number">38060</span> B/op         <span class="number">35</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Binding_Sonic_V1<span class="number">-12</span>                      <span class="number">100000</span>             <span class="number">32212</span> ns/op         <span class="number">404.72</span> MB/s       <span class="number">27327</span> B/op        <span class="number">137</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Binding_Sonic_Fast<span class="number">-12</span>                    <span class="number">100000</span>             <span class="number">28587</span> ns/op         <span class="number">456.05</span> MB/s       <span class="number">24280</span> B/op         <span class="number">34</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Binding_Sonnet<span class="number">-12</span>                        <span class="number">100000</span>             <span class="number">68974</span> ns/op         <span class="number">189.01</span> MB/s       <span class="number">50228</span> B/op        <span class="number">739</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Binding_StdLib<span class="number">-12</span>               <span class="number">100000</span>             <span class="number">27176</span> ns/op         <span class="number">479.73</span> MB/s       <span class="number">10575</span> B/op        <span class="number">208</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Binding_JsonIter<span class="number">-12</span>             <span class="number">100000</span>             <span class="number">11446</span> ns/op        <span class="number">1138.96</span> MB/s       <span class="number">14674</span> B/op        <span class="number">385</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Binding_GoJson<span class="number">-12</span>               <span class="number">100000</span>              <span class="number">9237</span> ns/op        <span class="number">1411.39</span> MB/s       <span class="number">22102</span> B/op         <span class="number">49</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Binding_Sonic<span class="number">-12</span>                <span class="number">100000</span>              <span class="number">9081</span> ns/op        <span class="number">1435.69</span> MB/s       <span class="number">39066</span> B/op         <span class="number">35</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Binding_Sonic_V1<span class="number">-12</span>             <span class="number">100000</span>              <span class="number">9358</span> ns/op        <span class="number">1393.20</span> MB/s       <span class="number">27372</span> B/op        <span class="number">137</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Binding_Sonic_Fast<span class="number">-12</span>           <span class="number">100000</span>              <span class="number">8292</span> ns/op        <span class="number">1572.23</span> MB/s       <span class="number">24347</span> B/op         <span class="number">34</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Binding_Sonnet<span class="number">-12</span>               <span class="number">100000</span>             <span class="number">11304</span> ns/op        <span class="number">1153.32</span> MB/s       <span class="number">11656</span> B/op        <span class="number">130</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Generic_StdLib<span class="number">-12</span>                        <span class="number">100000</span>            <span class="number">110818</span> ns/op         <span class="number">117.64</span> MB/s       <span class="number">44266</span> B/op        <span class="number">751</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Generic_JsonIter<span class="number">-12</span>                      <span class="number">100000</span>             <span class="number">44940</span> ns/op         <span class="number">290.10</span> MB/s       <span class="number">14347</span> B/op        <span class="number">115</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Generic_GoJson<span class="number">-12</span>                        <span class="number">100000</span>             <span class="number">68311</span> ns/op         <span class="number">190.85</span> MB/s       <span class="number">23464</span> B/op         <span class="number">18</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Generic_Sonic<span class="number">-12</span>                         <span class="number">100000</span>             <span class="number">33923</span> ns/op         <span class="number">384.31</span> MB/s       <span class="number">13759</span> B/op          <span class="number">4</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Generic_Sonic_Fast<span class="number">-12</span>                    <span class="number">100000</span>             <span class="number">23436</span> ns/op         <span class="number">556.28</span> MB/s        <span class="number">9727</span> B/op          <span class="number">4</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Generic_StdLib<span class="number">-12</span>               <span class="number">100000</span>             <span class="number">40058</span> ns/op         <span class="number">325.45</span> MB/s       <span class="number">44288</span> B/op        <span class="number">751</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Generic_JsonIter<span class="number">-12</span>             <span class="number">100000</span>             <span class="number">11915</span> ns/op        <span class="number">1094.20</span> MB/s       <span class="number">14358</span> B/op        <span class="number">115</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Generic_GoJson<span class="number">-12</span>               <span class="number">100000</span>             <span class="number">20948</span> ns/op         <span class="number">622.36</span> MB/s       <span class="number">23445</span> B/op         <span class="number">18</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Generic_Sonic<span class="number">-12</span>                <span class="number">100000</span>             <span class="number">10335</span> ns/op        <span class="number">1261.48</span> MB/s       <span class="number">14056</span> B/op          <span class="number">4</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Generic_Sonic_Fast<span class="number">-12</span>           <span class="number">100000</span>              <span class="number">5895</span> ns/op        <span class="number">2211.64</span> MB/s        <span class="number">9821</span> B/op          <span class="number">4</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Binding_StdLib<span class="number">-12</span>                        <span class="number">100000</span>             <span class="number">18100</span> ns/op         <span class="number">720.29</span> MB/s        <span class="number">9480</span> B/op          <span class="number">1</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Binding_JsonIter<span class="number">-12</span>                      <span class="number">100000</span>             <span class="number">22245</span> ns/op         <span class="number">586.08</span> MB/s        <span class="number">9487</span> B/op          <span class="number">2</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Binding_GoJson<span class="number">-12</span>                        <span class="number">100000</span>              <span class="number">7886</span> ns/op        <span class="number">1653.13</span> MB/s        <span class="number">9482</span> B/op          <span class="number">1</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Binding_Sonic<span class="number">-12</span>                         <span class="number">100000</span>              <span class="number">5659</span> ns/op        <span class="number">2303.64</span> MB/s       <span class="number">14253</span> B/op          <span class="number">4</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Binding_Sonic_Fast<span class="number">-12</span>                    <span class="number">100000</span>              <span class="number">4961</span> ns/op        <span class="number">2627.89</span> MB/s       <span class="number">10056</span> B/op          <span class="number">4</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Binding_StdLib<span class="number">-12</span>               <span class="number">100000</span>              <span class="number">4468</span> ns/op        <span class="number">2917.64</span> MB/s        <span class="number">9487</span> B/op          <span class="number">1</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Binding_JsonIter<span class="number">-12</span>             <span class="number">100000</span>              <span class="number">5370</span> ns/op        <span class="number">2427.56</span> MB/s        <span class="number">9496</span> B/op          <span class="number">2</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Binding_GoJson<span class="number">-12</span>               <span class="number">100000</span>              <span class="number">2928</span> ns/op        <span class="number">4453.05</span> MB/s        <span class="number">9500</span> B/op          <span class="number">1</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Binding_Sonic<span class="number">-12</span>                <span class="number">100000</span>              <span class="number">1348</span> ns/op        <span class="number">9670.27</span> MB/s       <span class="number">14279</span> B/op          <span class="number">4</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Binding_Sonic_Fast<span class="number">-12</span>           <span class="number">100000</span>              <span class="number">1162</span> ns/op        <span class="number">11219.60</span> MB/s      <span class="number">10056</span> B/op          <span class="number">4</span> allocs/op</span><br></pre></td></tr></table></figure>

<h3 id="解析大-JSON-字符串"><a href="#解析大-JSON-字符串" class="headerlink" title="解析大 JSON 字符串"></a>解析大 JSON 字符串</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">BenchmarkDecoder_Generic_StdLib<span class="number">-12</span>                          <span class="number">5000</span>           <span class="number">6120476</span> ns/op         <span class="number">103.18</span> MB/s     <span class="number">2151910</span> B/op      <span class="number">31261</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Generic_JsonIter<span class="number">-12</span>                        <span class="number">5000</span>           <span class="number">4260781</span> ns/op         <span class="number">148.22</span> MB/s     <span class="number">2427840</span> B/op      <span class="number">45043</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Generic_GoJson<span class="number">-12</span>                          <span class="number">5000</span>           <span class="number">4088162</span> ns/op         <span class="number">154.47</span> MB/s     <span class="number">2757799</span> B/op      <span class="number">39700</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Generic_Sonic<span class="number">-12</span>                           <span class="number">5000</span>           <span class="number">2561050</span> ns/op         <span class="number">246.58</span> MB/s     <span class="number">2609818</span> B/op      <span class="number">12137</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Generic_Sonic_V1<span class="number">-12</span>                        <span class="number">5000</span>           <span class="number">3041447</span> ns/op         <span class="number">207.64</span> MB/s     <span class="number">2344109</span> B/op      <span class="number">29781</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Generic_Sonic_Fast<span class="number">-12</span>                      <span class="number">5000</span>           <span class="number">2488119</span> ns/op         <span class="number">253.81</span> MB/s     <span class="number">1967848</span> B/op      <span class="number">12136</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Generic_Sonnet<span class="number">-12</span>                          <span class="number">5000</span>           <span class="number">3212028</span> ns/op         <span class="number">196.61</span> MB/s     <span class="number">2096696</span> B/op      <span class="number">30183</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Generic_StdLib<span class="number">-12</span>                 <span class="number">5000</span>           <span class="number">1534652</span> ns/op         <span class="number">411.50</span> MB/s     <span class="number">2152041</span> B/op      <span class="number">31262</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Generic_JsonIter<span class="number">-12</span>               <span class="number">5000</span>           <span class="number">1197112</span> ns/op         <span class="number">527.53</span> MB/s     <span class="number">2427316</span> B/op      <span class="number">45043</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Generic_GoJson<span class="number">-12</span>                 <span class="number">5000</span>           <span class="number">1046451</span> ns/op         <span class="number">603.48</span> MB/s     <span class="number">2756561</span> B/op      <span class="number">39698</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Generic_Sonic<span class="number">-12</span>                  <span class="number">5000</span>            <span class="number">699298</span> ns/op         <span class="number">903.07</span> MB/s     <span class="number">2614464</span> B/op      <span class="number">12136</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Generic_Sonic_V1<span class="number">-12</span>               <span class="number">5000</span>            <span class="number">906161</span> ns/op         <span class="number">696.91</span> MB/s     <span class="number">2343733</span> B/op      <span class="number">29780</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Generic_Sonic_Fast<span class="number">-12</span>             <span class="number">5000</span>            <span class="number">784229</span> ns/op         <span class="number">805.27</span> MB/s     <span class="number">1967387</span> B/op      <span class="number">12135</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Generic_Sonnet<span class="number">-12</span>                 <span class="number">5000</span>           <span class="number">1057777</span> ns/op         <span class="number">597.02</span> MB/s     <span class="number">2096632</span> B/op      <span class="number">30182</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Binding_StdLib<span class="number">-12</span>                          <span class="number">5000</span>           <span class="number">5519137</span> ns/op         <span class="number">114.42</span> MB/s      <span class="number">601858</span> B/op       <span class="number">5848</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Binding_JsonIter<span class="number">-12</span>                        <span class="number">5000</span>           <span class="number">1831864</span> ns/op         <span class="number">344.74</span> MB/s      <span class="number">748192</span> B/op      <span class="number">18781</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Binding_GoJson<span class="number">-12</span>                          <span class="number">5000</span>           <span class="number">1178029</span> ns/op         <span class="number">536.08</span> MB/s      <span class="number">901550</span> B/op       <span class="number">2799</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Binding_Sonic<span class="number">-12</span>                           <span class="number">5000</span>           <span class="number">1199569</span> ns/op         <span class="number">526.45</span> MB/s     <span class="number">1105079</span> B/op       <span class="number">1683</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Binding_Sonic_V1<span class="number">-12</span>                        <span class="number">5000</span>           <span class="number">1232027</span> ns/op         <span class="number">512.58</span> MB/s      <span class="number">560149</span> B/op       <span class="number">4533</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Binding_Sonic_Fast<span class="number">-12</span>                      <span class="number">5000</span>           <span class="number">1125198</span> ns/op         <span class="number">561.25</span> MB/s      <span class="number">464553</span> B/op       <span class="number">1682</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Binding_Sonnet<span class="number">-12</span>                          <span class="number">5000</span>           <span class="number">3055920</span> ns/op         <span class="number">206.65</span> MB/s     <span class="number">2096695</span> B/op      <span class="number">30183</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Binding_StdLib<span class="number">-12</span>                 <span class="number">5000</span>           <span class="number">1182782</span> ns/op         <span class="number">533.92</span> MB/s      <span class="number">601871</span> B/op       <span class="number">5848</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Binding_JsonIter<span class="number">-12</span>               <span class="number">5000</span>            <span class="number">476816</span> ns/op        <span class="number">1324.44</span> MB/s      <span class="number">748068</span> B/op      <span class="number">18781</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Binding_GoJson<span class="number">-12</span>                 <span class="number">5000</span>            <span class="number">271643</span> ns/op        <span class="number">2324.79</span> MB/s      <span class="number">901943</span> B/op       <span class="number">2795</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Binding_Sonic<span class="number">-12</span>                  <span class="number">5000</span>            <span class="number">281690</span> ns/op        <span class="number">2241.87</span> MB/s     <span class="number">1108846</span> B/op       <span class="number">1683</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Binding_Sonic_V1<span class="number">-12</span>               <span class="number">5000</span>            <span class="number">296465</span> ns/op        <span class="number">2130.15</span> MB/s      <span class="number">560588</span> B/op       <span class="number">4533</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Binding_Sonic_Fast<span class="number">-12</span>             <span class="number">5000</span>            <span class="number">264516</span> ns/op        <span class="number">2387.44</span> MB/s      <span class="number">465060</span> B/op       <span class="number">1682</span> allocs/op</span><br><span class="line">BenchmarkDecoder_Parallel_Binding_Sonnet<span class="number">-12</span>                 <span class="number">5000</span>            <span class="number">359303</span> ns/op        <span class="number">1757.61</span> MB/s      <span class="number">396600</span> B/op       <span class="number">4348</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Generic_StdLib<span class="number">-12</span>                          <span class="number">5000</span>           <span class="number">5943144</span> ns/op         <span class="number">106.26</span> MB/s     <span class="number">1920483</span> B/op      <span class="number">31055</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Generic_JsonIter<span class="number">-12</span>                        <span class="number">5000</span>           <span class="number">2492510</span> ns/op         <span class="number">253.36</span> MB/s      <span class="number">637167</span> B/op       <span class="number">3793</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Generic_GoJson<span class="number">-12</span>                          <span class="number">5000</span>           <span class="number">3550643</span> ns/op         <span class="number">177.86</span> MB/s     <span class="number">1100084</span> B/op        <span class="number">544</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Generic_Sonic<span class="number">-12</span>                           <span class="number">5000</span>           <span class="number">1134123</span> ns/op         <span class="number">556.83</span> MB/s      <span class="number">470115</span> B/op          <span class="number">5</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Generic_Sonic_V1<span class="number">-12</span>                        <span class="number">5000</span>           <span class="number">1649071</span> ns/op         <span class="number">382.95</span> MB/s      <span class="number">709381</span> B/op          <span class="number">5</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Generic_Sonic_Fast<span class="number">-12</span>                      <span class="number">5000</span>           <span class="number">1147522</span> ns/op         <span class="number">550.33</span> MB/s      <span class="number">470639</span> B/op          <span class="number">5</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Generic_Sonic<span class="number">-12</span>                  <span class="number">5000</span>            <span class="number">240012</span> ns/op        <span class="number">2631.17</span> MB/s      <span class="number">472896</span> B/op          <span class="number">4</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Generic_JsonIter<span class="number">-12</span>               <span class="number">5000</span>            <span class="number">485174</span> ns/op        <span class="number">1301.62</span> MB/s      <span class="number">644095</span> B/op       <span class="number">3793</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Generic_GoJson<span class="number">-12</span>                 <span class="number">5000</span>            <span class="number">749546</span> ns/op         <span class="number">842.53</span> MB/s     <span class="number">1060605</span> B/op        <span class="number">550</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Generic_StdLib<span class="number">-12</span>                 <span class="number">5000</span>           <span class="number">1702450</span> ns/op         <span class="number">370.94</span> MB/s     <span class="number">1922308</span> B/op      <span class="number">31055</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Generic_Sonic_V1<span class="number">-12</span>               <span class="number">5000</span>            <span class="number">582658</span> ns/op        <span class="number">1083.85</span> MB/s      <span class="number">712830</span> B/op          <span class="number">5</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Generic_Sonic_Fast<span class="number">-12</span>             <span class="number">5000</span>            <span class="number">348096</span> ns/op        <span class="number">1814.19</span> MB/s      <span class="number">471770</span> B/op          <span class="number">4</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Binding_StdLib<span class="number">-12</span>                          <span class="number">5000</span>           <span class="number">1115137</span> ns/op         <span class="number">566.31</span> MB/s      <span class="number">324698</span> B/op       <span class="number">1423</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Binding_JsonIter<span class="number">-12</span>                        <span class="number">5000</span>           <span class="number">1087129</span> ns/op         <span class="number">580.90</span> MB/s      <span class="number">275567</span> B/op        <span class="number">314</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Binding_GoJson<span class="number">-12</span>                          <span class="number">5000</span>            <span class="number">537630</span> ns/op        <span class="number">1174.63</span> MB/s      <span class="number">265792</span> B/op         <span class="number">15</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Binding_Sonic<span class="number">-12</span>                           <span class="number">5000</span>            <span class="number">212572</span> ns/op        <span class="number">2970.83</span> MB/s      <span class="number">264782</span> B/op          <span class="number">4</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Binding_Sonic_V1<span class="number">-12</span>                        <span class="number">5000</span>            <span class="number">255639</span> ns/op        <span class="number">2470.34</span> MB/s      <span class="number">391700</span> B/op          <span class="number">4</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Binding_Sonic_Fast<span class="number">-12</span>                      <span class="number">5000</span>            <span class="number">216416</span> ns/op        <span class="number">2918.05</span> MB/s      <span class="number">265716</span> B/op          <span class="number">4</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Binding_StdLib<span class="number">-12</span>                 <span class="number">5000</span>            <span class="number">186556</span> ns/op        <span class="number">3385.12</span> MB/s      <span class="number">325774</span> B/op       <span class="number">1423</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Binding_JsonIter<span class="number">-12</span>               <span class="number">5000</span>            <span class="number">174684</span> ns/op        <span class="number">3615.17</span> MB/s      <span class="number">278099</span> B/op        <span class="number">314</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Binding_GoJson<span class="number">-12</span>                 <span class="number">5000</span>            <span class="number">115085</span> ns/op        <span class="number">5487.37</span> MB/s      <span class="number">268657</span> B/op         <span class="number">15</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Binding_Sonic<span class="number">-12</span>                  <span class="number">5000</span>             <span class="number">43834</span> ns/op        <span class="number">14406.79</span> MB/s     <span class="number">267855</span> B/op          <span class="number">4</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Binding_Sonic_V1<span class="number">-12</span>               <span class="number">5000</span>             <span class="number">63657</span> ns/op        <span class="number">9920.59</span> MB/s      <span class="number">394323</span> B/op          <span class="number">4</span> allocs/op</span><br><span class="line">BenchmarkEncoder_Parallel_Binding_Sonic_Fast<span class="number">-12</span>             <span class="number">5000</span>             <span class="number">45873</span> ns/op        <span class="number">13766.56</span> MB/s     <span class="number">267750</span> B/op          <span class="number">4</span> allocs/op</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><strong>库名</strong></th>
<th><strong>数据量</strong></th>
<th>**泛型编码****性能**</th>
<th><strong>定型编码性能</strong></th>
<th><strong>泛型解码</strong></th>
<th><strong>定型解码</strong></th>
</tr>
</thead>
<tbody><tr>
<td>StdLib</td>
<td>小</td>
<td>⭐️</td>
<td>⭐️</td>
<td>⭐️⭐️</td>
<td>⭐️</td>
</tr>
<tr>
<td>中</td>
<td>⭐️</td>
<td>⭐️</td>
<td>⭐️</td>
<td>⭐️</td>
<td></td>
</tr>
<tr>
<td>大</td>
<td>⭐️</td>
<td>⭐️</td>
<td>⭐️</td>
<td>⭐️</td>
<td></td>
</tr>
<tr>
<td>JsonIter</td>
<td>小</td>
<td>⭐️⭐️⭐️</td>
<td>⭐️</td>
<td>⭐️⭐️</td>
<td>⭐️⭐️⭐️</td>
</tr>
<tr>
<td>中</td>
<td>⭐️⭐️⭐️</td>
<td>⭐️</td>
<td>⭐️⭐️</td>
<td>⭐️⭐️</td>
<td></td>
</tr>
<tr>
<td>大</td>
<td>⭐️⭐️⭐️⭐</td>
<td>⭐️</td>
<td>⭐️⭐️</td>
<td>⭐️⭐️</td>
<td></td>
</tr>
<tr>
<td>GoJson</td>
<td>小</td>
<td>⭐️⭐️⭐️</td>
<td>⭐️⭐️</td>
<td>⭐️</td>
<td>⭐️⭐️⭐️</td>
</tr>
<tr>
<td>中</td>
<td>⭐️⭐️</td>
<td>⭐️⭐️⭐️</td>
<td>⭐️⭐️⭐️</td>
<td>⭐️⭐️⭐️⭐️</td>
<td></td>
</tr>
<tr>
<td>大</td>
<td>⭐️⭐️⭐️</td>
<td>⭐️⭐️⭐️</td>
<td>⭐️⭐️⭐️</td>
<td>⭐️⭐️⭐️⭐️</td>
<td></td>
</tr>
<tr>
<td>Sonic</td>
<td>小</td>
<td>⭐️⭐️⭐️⭐</td>
<td>⭐️⭐️⭐️⭐️</td>
<td>⭐️⭐️⭐️⭐️</td>
<td>⭐️⭐️⭐️⭐️</td>
</tr>
<tr>
<td>中</td>
<td>⭐️⭐️⭐️⭐️</td>
<td>⭐️⭐️⭐️⭐️</td>
<td>⭐️⭐️⭐️⭐️</td>
<td>⭐️⭐️⭐️⭐️</td>
<td></td>
</tr>
<tr>
<td>大</td>
<td>⭐️⭐️⭐️⭐</td>
<td>⭐️⭐️⭐️⭐</td>
<td>⭐️⭐️⭐️⭐️</td>
<td>⭐️⭐️⭐️⭐️</td>
<td></td>
</tr>
<tr>
<td>Sonnet</td>
<td>小</td>
<td>-</td>
<td>-</td>
<td>⭐️⭐️⭐️</td>
<td>⭐️⭐️</td>
</tr>
<tr>
<td>中</td>
<td>-</td>
<td>-</td>
<td>⭐️⭐️⭐️</td>
<td>⭐️⭐️</td>
<td></td>
</tr>
<tr>
<td>大</td>
<td>-</td>
<td>-</td>
<td>⭐️⭐️⭐️</td>
<td>⭐️⭐️</td>
<td></td>
</tr>
</tbody></table>
<h1 id="优化思路"><a href="#优化思路" class="headerlink" title="优化思路"></a>优化思路</h1><h2 id="定型编解码优化"><a href="#定型编解码优化" class="headerlink" title="定型编解码优化"></a>定型编解码优化</h2><p>核心思想：<strong>将模型解释与数据处理逻辑分离，让前者在提前固定下来，进而消除反射，提升性能。</strong></p>
<p>对于有 schema 的定型编解码场景而言，很多运算其实不需要在“运行时”执行。</p>
<p>eg：如果业务模型中确定了某个 JSON key 的值一定是布尔类型，那么我们就可以在序列化阶段直接输出这个对象对应的 JSON 值（‘true’或‘false’），并不需要再检查这个对象的具体类型。</p>
<h3 id="优化数据处理逻辑"><a href="#优化数据处理逻辑" class="headerlink" title="优化数据处理逻辑"></a>优化数据处理逻辑</h3><p>JsonIter 使用函数组装模式，具体方法：将结构解释为逐个字段的编码和解码函数，然后将其组装并缓存为整个对象对应的编解码器，运行时再加载出来处理 JSON，将反射的性能损失成本降到最低。</p>
<p>但这是否能一劳永逸呢？不是。因为原因是这个实现转化为大量的接口封装和函数调用栈。在实际测试中，发现随着 JSON 数据量级的增长，function-call 开销也成倍放大。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> cache <span class="keyword">struct</span> &#123;</span><br><span class="line">	functions <span class="keyword">map</span>[*rtype]function</span><br><span class="line">	lock      sync.Mutex</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	global = <span class="function"><span class="keyword">func</span><span class="params">()</span></span> [caches]*cache &#123;</span><br><span class="line">		<span class="keyword">var</span> caches [caches]*cache</span><br><span class="line">		<span class="keyword">for</span> idx := <span class="keyword">range</span> caches &#123;</span><br><span class="line">			caches[idx] = &amp;cache&#123;functions: <span class="built_in">make</span>(<span class="keyword">map</span>[*rtype]function, <span class="number">4</span>)&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> caches</span><br><span class="line">	&#125;()</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>调用接口涉及动态寻址，汇编函数不能被内联，而 Golang 的函数调用性能很差（没有逐个寄存器的参数传递）。</p>
<p><strong>有什么办法可以避免动态汇编的函数调用开销吗？</strong></p>
<p>业界实现方式目前主要有两种：代码生成 code-gen 和 即时编译 JIT。</p>
<h3 id="code-gen"><a href="#code-gen" class="headerlink" title="code-gen"></a>code-gen</h3><p>采用 code-gen(代码生成)，代表性的库有：easyjson；</p>
<p>库开发者实现起来相对简单，性能高，但是它伴随着模式依赖性和便利性的损失，增加业务代码的维护成本和局限性，无法做到秒级热更新（这也是代码生成方式的 JSON 库受众并不广泛的原因）</p>
<h3 id="JIT"><a href="#JIT" class="headerlink" title="JIT"></a>JIT</h3><p>JIT (即时编译)的核心思想是将模型解释与数据处理逻辑分离，让前者在“编译期”固定下来。<strong>将编译过程移到了程序的加载（或首次解析）阶段</strong>，只需要提供 JSON schema 对应的结构体类型信息，就可以一次性编译生成对应的编解码器(以 Golang 函数的形式缓存到堆外内存)并高效执行。</p>
<p>案例：<a target="_blank" rel="noopener" href="https://github.com/sugawarayuuta/sonnet">https://github.com/sugawarayuuta/sonnet</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> cache <span class="keyword">struct</span> &#123;</span><br><span class="line">	functions <span class="keyword">map</span>[*rtype]function</span><br><span class="line">	lock      sync.Mutex</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	global = <span class="function"><span class="keyword">func</span><span class="params">()</span></span> [caches]*cache &#123;</span><br><span class="line">		<span class="keyword">var</span> caches [caches]*cache</span><br><span class="line">		<span class="keyword">for</span> idx := <span class="keyword">range</span> caches &#123;</span><br><span class="line">			caches[idx] = &amp;cache&#123;functions: <span class="built_in">make</span>(<span class="keyword">map</span>[*rtype]function, <span class="number">4</span>)&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> caches</span><br><span class="line">	&#125;()</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">load</span><span class="params">(typ *rtype)</span></span> (function, <span class="type">bool</span>) &#123;</span><br><span class="line">	do, ok := global[<span class="type">uintptr</span>(unsafe.Pointer(typ))%caches].functions[typ]</span><br><span class="line">	<span class="keyword">return</span> do, ok</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">save</span><span class="params">(typ *rtype, do function)</span></span> &#123;</span><br><span class="line">	cache := global[<span class="type">uintptr</span>(unsafe.Pointer(typ))%caches]</span><br><span class="line">	cache.lock.Lock()</span><br><span class="line">	cache.functions[typ] = do</span><br><span class="line">	cache.lock.Unlock()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="泛型编解码优化"><a href="#泛型编解码优化" class="headerlink" title="泛型编解码优化"></a>泛型编解码优化</h2><h3 id="性能差只是因为没有-schema-吗？"><a href="#性能差只是因为没有-schema-吗？" class="headerlink" title="性能差只是因为没有 schema 吗？"></a>性能差只是因为没有 schema 吗？</h3><p>可以对比一下 C++ 的 JSON 库，如 rappidjson、simdjson，它们的解析方式都是泛型的，但性能仍然很好；</p>
<p>标准库泛型解析性能差的根本原因在于它采用了 <strong>Go 标准泛型——interface（map[string]interface{}）作为 JSON 的编解码对象</strong>。这其实是一种糟糕的选择：首先是数据反序列化的过程中，map 插入的开销很高；其次在数据序列化过程中，map 遍历也远不如数组高效。</p>
<p>优化思路：如果用一种与 JSON AST 更贴近的数据结构来描述，不但可以让转换过程更加简单，甚至可以实现按需加载（lazy-load）。</p>
<h3 id="lazy-load"><a href="#lazy-load" class="headerlink" title="lazy-load"></a>lazy-load</h3><p>GJson 在单键查找的场景下有很大的优势。这是因为它的查找是通过按需加载实现的，它巧妙地跳过了传递值，有效地减少了很多不必要的解析，但其实跳过也是一种轻量级解析（处理 JSON 控制字符“[”、“{”等）。但当涉及到多键查找时，Gjson 做的事比 StdLib 更糟糕，这是其跳过机制的副作用(相同路径查找导致的重复开销)。</p>
<h2 id="buffer-reuse"><a href="#buffer-reuse" class="headerlink" title="buffer-reuse"></a>buffer-reuse</h2><p>复用 encode buffer，通过使用 sync.Pool 重用用于先前编码的缓冲区，减少 encode buffer 的内存分配次数。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> buffer <span class="keyword">struct</span> &#123;</span><br><span class="line">    data []<span class="type">byte</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bufPool = sync.Pool&#123;</span><br><span class="line">    New: <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="keyword">interface</span>&#123;&#125; &#123;</span><br><span class="line">        <span class="keyword">return</span> &amp;buffer&#123;data: <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">0</span>, <span class="number">1024</span>)&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">buf := bufPool.Get().(*buffer)</span><br><span class="line">data := encode(buf.data) <span class="comment">// reuse buf.data</span></span><br><span class="line"></span><br><span class="line">newBuf := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="built_in">len</span>(data))</span><br><span class="line"><span class="built_in">copy</span>(newBuf, buf)</span><br><span class="line"></span><br><span class="line">buf.data = data</span><br><span class="line">bufPool.Put(buf)</span><br></pre></td></tr></table></figure>

<h1 id="Sonic"><a href="#Sonic" class="headerlink" title="Sonic"></a>Sonic</h1><h2 id="Sonic-为什么性能高？"><a href="#Sonic-为什么性能高？" class="headerlink" title="Sonic 为什么性能高？"></a>Sonic 为什么性能高？</h2><p>主要通过基于汇编进行开发，充分利用向量化（SIMD）指令、优化内存布局和按需解析等关键技术，大幅提高了序列化反序列化性能。</p>
<img src="/2023/04/09/%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86/Go%20JSON%20%E5%BA%93%E8%B0%83%E7%A0%94/1679235214712-4c7ab60e-dd98-4584-b6a7-4eb98b153639-9412240.png" alt="img">

<ul>
<li>借鉴 json-iterator 的组装各类型处理函数的实现，不同之处在于直接编译出来，减少了函数调用的开销。</li>
<li>simd-json 虽然也使用了 simd，但是使用的是 go 的编译器，相比 clang 所做的优化更少。</li>
<li>使用 cgo(可以直接用 golang 编译并调用 C 代码)的实现虽然更加简便，对代码进行了深度优化， 但 cgo 在调用 c 代码的时候引入了调度、切换线程栈等开销，会造成较大（有的场景中高达 20 多倍）的性能损耗。</li>
</ul>
<h3 id="离线编译"><a href="#离线编译" class="headerlink" title="离线编译"></a>离线编译</h3><p>对于 go 语言编译优化的不足，核心计算函数(热点操作)使用 C 语言编写，使用 Clang 的深度优化编译选项，并开发了一套 asm2asm 工具，将完全优化的 x86 汇编翻译成 plan9 汇编，加载到 Golang 运行时，以供调用。</p>
<h4 id="SIMD"><a href="#SIMD" class="headerlink" title="SIMD"></a>SIMD</h4><p>JSON 文本的处理与计算。其中一些问题在业界已经有比较成熟高效的解决方案，如浮点数转字符串算法 Ryu，整数转字符串的查表法等；而一些问题逻辑相对简单，但是可能会面对较大数量级的文本，如 JSON string 的 unquote\quote 处理、空白字符的跳过等，也需要某种技术手段来提升处理能力，而 SIMD 就是一种用于并行处理大规模数据的技术，</p>
<p>SIMD（Single-Instruction-Multi-Data 单指令流多数据流）它是一种采用一个控制器来控制多个处理器，同时对一组数据中的每一个数据分别执行相同的操作，从而实现空间上的并行性技术。例如：X86 的 SSE 或者 AVX2 指令集，以及 ARM 的 NEON 指令集等。它作为一组特殊的 CPU 指令，用于矢量数据的并行处理。目前，它被大多数 CPU 所支持，并广泛用于图像处理和大数据计算中。</p>
<p>SIMD 在 JSON 处理中也很有用，<a target="_blank" rel="noopener" href="https://github.com/minio/simdjson-go">simdjson-go</a> 在大型 JSON 场景（&gt;100KB）中非常有竞争力。然而，对于一些极小的或不规则的字符串，SIMD 所需的额外负载操作将导致性能下降。因此， 对于大数据和小数据并存的实际场景，采用预设条件判断（字符串大小、浮动精度等），将 SIMD 和标量指令结合起来，以达到最佳适应性。</p>
<h4 id="汇编转换-asm2asm"><a href="#汇编转换-asm2asm" class="headerlink" title="汇编转换-asm2asm"></a>汇编转换-asm2asm</h4><p>一些关键的计算函数是否可以用另一种执行效率更高的语言来编写呢？C&#x2F;Clang 是一个理想的编译工具，但关键是如何将优化后的汇编嵌入 Golang 中？</p>
<p>由于 clang 编译出来的是 x86 汇编，而 golang 编译出来的是 plan9 汇编。为了在 golang 中调用 clang 编译出来的汇编，字节开发了一个工具(tools&#x2F;asm2asm)将 x86 的汇编转换为 plan9。</p>
<h3 id="JIT-汇编"><a href="#JIT-汇编" class="headerlink" title="JIT 汇编"></a>JIT 汇编</h3><p>针对编解码器动态装配的函数调用开销，采用 JIT 技术在运行时对模式对应的操作码（asm）进行装配，最后以 Golang 函数的形式缓存到堆外内存。因为编译后的编解码函数是一个集成函数，可以大大减少函数调用，同时保证灵活性；</p>
<h4 id="RCU-cache"><a href="#RCU-cache" class="headerlink" title="RCU cache"></a>RCU cache</h4><p>为了提升 codec cache 的加载速度，每个结构体对应的序列化&#x2F;反序列化字节码可以缓存起来，后面直接调用，以减少运行时汇编操作的执行次数（缓存足够大的时候只需要执行一次）。Sync.Map 最初是用来缓存编解码器的，但对于准静态（读远多于写）、较少元素（通常不超过几十个）的场景来说，其性能并不理想，所以用“开放寻址哈希+RCU 技术”重新实现了一个高性能和并发安全的缓存。</p>
<h4 id="已知结构体的场景"><a href="#已知结构体的场景" class="headerlink" title="已知结构体的场景"></a>已知结构体的场景</h4><p>JIT 汇编是比较耗时的，在线进行会导致首次请求耗时较高。对于 json 对应的结构体已知的服务场景，可以在预先生成好汇编后的字节码，不用引入 JIT 机制。</p>
<h4 id="其他优化"><a href="#其他优化" class="headerlink" title="其他优化"></a>其他优化</h4><ul>
<li>无栈内存管理：自己维护变量栈（内存池），避免 Go 函数栈扩展。</li>
<li>自动生成跳转表，加速 generic decoding 的分支跳转。</li>
<li>使用寄存器传参：将使用频繁的变量放到固定的寄存器上（如 JSON buffer、结构体指针），尽量避免 memory load &amp; store。</li>
<li>重写函数调用：由于汇编函数不能内联到 go 函数中，函数调用引入的开销甚至会抵消 SIMD 带来的性能提升，因此在 JIT 中重新实现了一组轻量级的函数调用（维护全局函数表+函数 offset）。</li>
</ul>
<h3 id="lazy-load-1"><a href="#lazy-load-1" class="headerlink" title="lazy-load"></a>lazy-load</h3><p>针对泛型编解码，基于 map 开销较大的考虑，sonic 实现了更能符合 json 结构的树形 AST；针对部分解析，使用 lazy-load 技术并且以一种更自适应和有效的方式处理多字段查询的场景。</p>
<p>考虑到解析和跳过之间的巨大速度差距，用 node {type, length, pointer} 表示任意一个 JSON 数据节点，并结合树与数组结构描述节点之间的层级关系。将 lazy-load 机制到 AST 解析器中，以一种更加自适应和高效的方式来减少多键查询的开销。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Node <span class="keyword">struct</span> &#123;</span><br><span class="line">    v <span class="type">int64</span></span><br><span class="line">    t types.ValueType</span><br><span class="line">    p unsafe.Pointer</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/2023/04/09/%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86/Go%20JSON%20%E5%BA%93%E8%B0%83%E7%A0%94/1678849837151-7839eba4-c94b-4bbe-bea2-7eabd7b0413d-9412226.png" alt="img">

<p>sonic-ast 实现了一种有状态、可伸缩的 JSON 解析过程：当使用者 get 某个 key 时，sonic 采用 skip 计算来轻量化跳过要获取的 key 之前的 json 文本；对于该 key 之后的 JSON 节点，直接不做任何的解析处理；仅使用者真正需要的 key 才完全解析。</p>
<p>**如何解决****相同路径查找导致的重复开销？**</p>
<p>sonic 在对于子节点 skip 处理过程增加了一个步骤，将跳过 JSON 的 key、起始位、结束位记录下来，分配一个 Raw-JSON 类型的节点保存下来，这样二次 skip 就可以直接基于节点的 offset 进行。同时 sonic-ast 支持了节点的更新、插入和序列化，甚至支持将任意 Go types 转为节点并保存下来</p>
<p>总而言之，sonic-ast 可以作为一种通用的泛型数据容器替代 Go interface。</p>
<h3 id="Sonic-落地"><a href="#Sonic-落地" class="headerlink" title="Sonic 落地"></a>Sonic 落地</h3><p>golang 现有的库中没有一个可以在全场景下保持优异的性能，即使是 json-iterator，在泛型编解码、大数据量级场景下的性能也会下降。与其他语言相比，golang 的各种 json 库速度都慢了很多，存在优化空间。</p>
<h2 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h2><p>由于 sonic 优化的是 json 操作，所以在 json 操作的 cpu 开销占比较大的服务场景中收益会比较明显。比如网关、转发和入口服务等。</p>
<h2 id="快速试用-sonic"><a href="#快速试用-sonic" class="headerlink" title="快速试用 sonic"></a>快速试用 sonic</h2><p>想要了解 sonic 会对自己的服务产生多大的性能提升，评估是否值得切换，可以下面的方式较小侵入地将当前使用的 json 库切换为 sonic：使用<a href="https://link.zhihu.com/?target=http://github.com/brahma-adshonor/gohook">http://github.com/brahma-adshonor/gohook</a>，在 main 函数的入口处 hook 当前使用的 json 库函数为 sonic 中对等的函数。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;github.com/brahma-adshonor/gohook&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 在main函数的入口hook当前使用的json库（如encoding/json）</span></span><br><span class="line">    gohook.Hook(json.Marshal, sonic.Marshal, <span class="literal">nil</span>)</span><br><span class="line">    gohook.Hook(json.Unmarshal, sonic.Unmarshal, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>hook 是函数级的，因此可以具体验证具体函数的性能提升，也可以部分函数使用 sonic（出于对某些函数的不信任、或者自己有性能更优异或更稳定的实现）。</p>
<p>注意：<a target="_blank" rel="noopener" href="http://github.com/brahma-adshonor/gohook">gohook</a>的大概实现是向被 hook 的函数地址中写入跳转指令，直接跳转到新的函数地址。 <em>需要注意的是，gohook 未经过生产环境验证，建议仅测试使用。</em></p>
<h2 id="使用注意事项"><a href="#使用注意事项" class="headerlink" title="使用注意事项"></a>使用注意事项</h2><h3 id="key-排序"><a href="#key-排序" class="headerlink" title="key 排序"></a>key 排序</h3><p>sonic 在序列化时默认是不对 key 进行排序的。json 的规范也与顺序无关，但若需要 json 是有序的，可以在序列化时选择排序的配置，大约会带来 10%的性能损耗。排序方法如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;github.com/bytedance/sonic&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;github.com/bytedance/sonic/encoder&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Binding map only</span></span><br><span class="line">m := <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;&#125;</span><br><span class="line">v, err := encoder.Encode(m, encoder.SortMapKeys)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Or ast.Node.SortKeys() before marshal</span></span><br><span class="line"><span class="keyword">var</span> root := sonic.Get(JSON)</span><br><span class="line">err := root.SortKeys()</span><br></pre></td></tr></table></figure>

<h3 id="HTML-Escape"><a href="#HTML-Escape" class="headerlink" title="HTML Escape"></a>HTML Escape</h3><p>标准库中默认会开启 html Escape，而 Sonic 出于性能损耗默认不开启</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestEncode</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">	data := <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>&#123;<span class="string">&quot;&amp;&amp;&quot;</span>: <span class="string">&quot;&lt;&gt;&quot;</span>&#125;</span><br><span class="line">	<span class="comment">// 标准库</span></span><br><span class="line">	<span class="keyword">var</span> w1 = bytes.NewBuffer(<span class="literal">nil</span>)</span><br><span class="line">	enc1 := json.NewEncoder(w1)</span><br><span class="line">	err := enc1.Encode(data)</span><br><span class="line">	assert.NoError(t, err)</span><br><span class="line">    <span class="comment">// Sonic 库</span></span><br><span class="line">	<span class="keyword">var</span> w2 = bytes.NewBuffer(<span class="literal">nil</span>)</span><br><span class="line">	enc2 := encoder.NewStreamEncoder(w2)</span><br><span class="line">	err = enc2.Encode(data)</span><br><span class="line">	assert.NoError(t, err)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;%v%v&quot;</span>, w1.String(), w2.String())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行结果：</span></span><br><span class="line">&#123;<span class="string">&quot;\u0026\u0026&quot;</span>:<span class="string">&quot;\u003c\u003e&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;&amp;&amp;&quot;</span>:<span class="string">&quot;&lt;&gt;&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>若需要开启，可以通过下面的方法：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;github.com/bytedance/sonic/encoder&quot;</span></span><br><span class="line"></span><br><span class="line">v := <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>&#123;<span class="string">&quot;&amp;&amp;&quot;</span>:<span class="string">&quot;&lt;&gt;&quot;</span>&#125;</span><br><span class="line">ret, err := encoder.Encode(v, EscapeHTML) <span class="comment">// ret == `&#123;&quot;\u0026\u0026&quot;:&#123;&quot;X&quot;:&quot; \u003e&quot;&#125;&#125;`</span></span><br><span class="line"></span><br><span class="line">enc := encoder.NewStreamEncoder(w)</span><br><span class="line">enc.SetEscapeHTML(<span class="literal">true</span>)</span><br><span class="line">err := enc.Encode(obj)</span><br></pre></td></tr></table></figure>

<h3 id="大型模式问题"><a href="#大型模式问题" class="headerlink" title="大型模式问题"></a>大型模式问题</h3><p>由于 Sonic 使用 golang-asm 作为 JIT 汇编器，这不太适合运行时编译，因此首次运行大型模式可能会导致请求超时甚至处理 OOM。为了获得更好的稳定性，建议在 Marshal（）&#x2F;Unmarshal（）之前使用 Pretouch（）来处理大型模式或紧凑内存应用程序。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;reflect&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/bytedance/sonic&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/bytedance/sonic/option&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> v HugeStruct</span><br><span class="line"></span><br><span class="line">    <span class="comment">// For most large types (nesting depth &lt;= option.DefaultMaxInlineDepth)</span></span><br><span class="line">    err := sonic.Pretouch(reflect.TypeOf(v))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// with more CompileOption...</span></span><br><span class="line">    err := sonic.Pretouch(reflect.TypeOf(v),</span><br><span class="line">        <span class="comment">// If the type is too deep nesting (nesting depth &gt; option.DefaultMaxInlineDepth),</span></span><br><span class="line">        <span class="comment">// you can set compile recursive loops in Pretouch for better stability in JIT.</span></span><br><span class="line">        option.WithCompileRecursiveDepth(loop),</span><br><span class="line">        <span class="comment">// For a large nested struct, try to set a smaller depth to reduce compiling time.</span></span><br><span class="line">        option.WithCompileMaxInlineDepth(depth),</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><p>综上，选型上需要根据具体情况、不同领域的业务使用场景和发展趋势进行选择，综合考虑各方面因素。</p>
<p>例如：业务也只是简单的解析 http 请求返回的 JSON 串的部分字段，并且字段都是确定的，偶尔需要搜索功能，那 Gjson 是很不错的选择。</p>
<p>最后，不得不承认，从性能和功能总体而言，Sonic 的表现的确很亮眼。</p>
<p>其次，对于 cpu 密集性的操作的优化提供一种“野路子”：通过编写高性能的 C 代码并经过优化编译后供 golang 直接调用。实际上 Go 源码中的一些 cpu 密集型操作也编译成了汇编，如 crypto 和 math。</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a target="_blank" rel="noopener" href="https://www.luozhiyun.com/archives/535">深入 Go 中各个高性能 JSON 解析库</a></p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1820473">Go 语言原生的 json 包有什么问题？如何更好地处理 JSON 数据？ </a></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzI1MzYzMjE0MQ==&mid=2247491325&idx=1&sn=e8799316d55c0951b0b54b404a3d87b8&scene=21#wechat_redirect">sonic ：基于 JIT 技术的开源全场景高性能 JSON 库</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/bytedance/sonic/blob/main/INTRODUCTION.md">sonic&#x2F;INTRODUCTION.md at main · bytedance&#x2F;sonic</a></p>
<p><a target="_blank" rel="noopener" href="https://pkg.go.dev/github.com/bytedance/sonic@v1.8.3#section-readme">sonic package - github.com&#x2F;bytedance&#x2F;sonic - Go Packages</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/goccy/go-json#how-it-works">goccy&#x2F;go-json: Fast JSON encoder&#x2F;decoder</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/586050976">【后台技术】为字节节省数十万核的 json 库 sonic</a></p>
<h1 id="课后思考"><a href="#课后思考" class="headerlink" title="课后思考"></a>课后思考</h1><ul>
<li>为什么 Go 不使用主流汇编，而是小众的 plan9 汇编？</li>
<li>Sonic 本身有哪些局限性？</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://zhao520a1a.github.io">Golden</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://zhao520a1a.github.io/2023/04/09/%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86/Go%20JSON%20%E5%BA%93%E8%B0%83%E7%A0%94/">https://zhao520a1a.github.io/2023/04/09/%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86/Go%20JSON%20%E5%BA%93%E8%B0%83%E7%A0%94/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://zhao520a1a.github.io" target="_blank">发光の金子吖</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/go/">go</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.processon.com/643289818976261088dae76b?e=1681037201&amp;token=trhI0BY8QfVrIGn9nENop6JAc6l5nZuxhjQ62UfM:7_9-iyaq39lLvAlJyPfFSQBbXxQ=" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2023/02/02/%E6%95%88%E7%8E%87%E5%B7%A5%E5%85%B7/Copilot/" title="copilot 使用指南"><img class="cover" src="https://cdn.processon.com/643428cf8976261088db0164?e=1681143519&amp;token=trhI0BY8QfVrIGn9nENop6JAc6l5nZuxhjQ62UfM:7JpU2MUkcaXceDC5D_0dJH47My8=" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">copilot 使用指南</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/06/01/%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86/Go%20%E8%B0%83%E5%BA%A6%E7%AF%87/" title="Go 调度篇"><img class="cover" src="http://cdn.processon.com/64328ff87b8fb67d7437cf7d?e=1681038856&token=trhI0BY8QfVrIGn9nENop6JAc6l5nZuxhjQ62UfM:iEHc73N41iwNc8JFkO8q5HjYMlo=" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-06-01</div><div class="title">Go 调度篇</div></div></a></div><div><a href="/2022/06/21/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/GO%E4%BB%A3%E7%A0%81%E9%A3%8E%E6%A0%BC%E6%80%BB%E7%BB%93%EF%BC%88%E7%A7%81%E8%97%8F%EF%BC%89/" title="代码风格规范"><img class="cover" src="http://cdn.processon.com/64342a4fe6c7164a487420a6?e=1681143904&token=trhI0BY8QfVrIGn9nENop6JAc6l5nZuxhjQ62UfM:nE2v8C7oqNs0bPGFUBTxuJ8S6k4=" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-06-21</div><div class="title">代码风格规范</div></div></a></div><div><a href="/2022/05/09/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/Go%20%E5%8F%AF%E7%BB%B4%E6%8A%A4%E6%80%A7%E5%BB%BA%E8%AE%AE/" title="Go 可维护性建议"><img class="cover" src="http://cdn.processon.com/64342ab179917d026621f8db?e=1681144001&token=trhI0BY8QfVrIGn9nENop6JAc6l5nZuxhjQ62UfM:v-X8EYjc7DqViRYwFiT4EMlIkN8=" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-09</div><div class="title">Go 可维护性建议</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Golden</div><div class="author-info__description">一个乐观的悲观主义者</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">25</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/zhao520a1a"><i class="fab fa-github"></i><span>关注一下</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/zhao520a1a" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://space.bilibili.com/334383730" target="_blank" title="B 站"><i class="fab fa-bilibili"></i></a><a class="social-icon" href="https://zhao520a1a.github.io/about/index/qrCode.png" target="_blank" title="微信公众号"><i class="fab fa-weixin"></i></a><a class="social-icon" href="https://www.processon.com/u/5ab9cb2de4b018c271cab8d4/profile" target="_blank" title="ProcessOn"><i class="far fa-lightbulb"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">广告位招租！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%95%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">引言</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%A0%E7%9C%9F%E7%9A%84%E4%BA%86%E8%A7%A3-JSON-%E5%A4%84%E7%90%86%E5%90%97%EF%BC%9F"><span class="toc-number">1.1.</span> <span class="toc-text">你真的了解 JSON 处理吗？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%87%E5%87%86%E5%BA%93%E6%9C%89%E4%BB%80%E4%B9%88%E9%97%AE%E9%A2%98%EF%BC%9F"><span class="toc-number">1.2.</span> <span class="toc-text">标准库有什么问题？</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B0%83%E7%A0%94%E6%80%9D%E8%B7%AF"><span class="toc-number">2.</span> <span class="toc-text">调研思路</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%84%E5%88%A4%E6%A0%87%E5%87%86"><span class="toc-number">2.1.</span> <span class="toc-text">评判标准</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">2.2.</span> <span class="toc-text">使用方式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E4%B8%89%E6%96%B9%E5%BA%93"><span class="toc-number">3.</span> <span class="toc-text">测试三方库</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E5%AF%B9%E6%AF%94"><span class="toc-number">3.1.</span> <span class="toc-text">功能对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94"><span class="toc-number">3.2.</span> <span class="toc-text">性能对比</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90%E5%B0%8F-JSON-%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">3.2.1.</span> <span class="toc-text">解析小 JSON 字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90%E4%B8%AD-JSON-%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">3.2.2.</span> <span class="toc-text">解析中 JSON 字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90%E5%A4%A7-JSON-%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">3.2.3.</span> <span class="toc-text">解析大 JSON 字符串</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E6%80%9D%E8%B7%AF"><span class="toc-number">4.</span> <span class="toc-text">优化思路</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E5%9E%8B%E7%BC%96%E8%A7%A3%E7%A0%81%E4%BC%98%E5%8C%96"><span class="toc-number">4.1.</span> <span class="toc-text">定型编解码优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E9%80%BB%E8%BE%91"><span class="toc-number">4.1.1.</span> <span class="toc-text">优化数据处理逻辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#code-gen"><span class="toc-number">4.1.2.</span> <span class="toc-text">code-gen</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JIT"><span class="toc-number">4.1.3.</span> <span class="toc-text">JIT</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%9B%E5%9E%8B%E7%BC%96%E8%A7%A3%E7%A0%81%E4%BC%98%E5%8C%96"><span class="toc-number">4.2.</span> <span class="toc-text">泛型编解码优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E5%B7%AE%E5%8F%AA%E6%98%AF%E5%9B%A0%E4%B8%BA%E6%B2%A1%E6%9C%89-schema-%E5%90%97%EF%BC%9F"><span class="toc-number">4.2.1.</span> <span class="toc-text">性能差只是因为没有 schema 吗？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lazy-load"><span class="toc-number">4.2.2.</span> <span class="toc-text">lazy-load</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#buffer-reuse"><span class="toc-number">4.3.</span> <span class="toc-text">buffer-reuse</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Sonic"><span class="toc-number">5.</span> <span class="toc-text">Sonic</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Sonic-%E4%B8%BA%E4%BB%80%E4%B9%88%E6%80%A7%E8%83%BD%E9%AB%98%EF%BC%9F"><span class="toc-number">5.1.</span> <span class="toc-text">Sonic 为什么性能高？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A6%BB%E7%BA%BF%E7%BC%96%E8%AF%91"><span class="toc-number">5.1.1.</span> <span class="toc-text">离线编译</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SIMD"><span class="toc-number">5.1.1.1.</span> <span class="toc-text">SIMD</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B1%87%E7%BC%96%E8%BD%AC%E6%8D%A2-asm2asm"><span class="toc-number">5.1.1.2.</span> <span class="toc-text">汇编转换-asm2asm</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JIT-%E6%B1%87%E7%BC%96"><span class="toc-number">5.1.2.</span> <span class="toc-text">JIT 汇编</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#RCU-cache"><span class="toc-number">5.1.2.1.</span> <span class="toc-text">RCU cache</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B7%B2%E7%9F%A5%E7%BB%93%E6%9E%84%E4%BD%93%E7%9A%84%E5%9C%BA%E6%99%AF"><span class="toc-number">5.1.2.2.</span> <span class="toc-text">已知结构体的场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E4%BC%98%E5%8C%96"><span class="toc-number">5.1.2.3.</span> <span class="toc-text">其他优化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lazy-load-1"><span class="toc-number">5.1.3.</span> <span class="toc-text">lazy-load</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Sonic-%E8%90%BD%E5%9C%B0"><span class="toc-number">5.1.4.</span> <span class="toc-text">Sonic 落地</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">5.2.</span> <span class="toc-text">适用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E8%AF%95%E7%94%A8-sonic"><span class="toc-number">5.3.</span> <span class="toc-text">快速试用 sonic</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">5.4.</span> <span class="toc-text">使用注意事项</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#key-%E6%8E%92%E5%BA%8F"><span class="toc-number">5.4.1.</span> <span class="toc-text">key 排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTML-Escape"><span class="toc-number">5.4.2.</span> <span class="toc-text">HTML Escape</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%A7%E5%9E%8B%E6%A8%A1%E5%BC%8F%E9%97%AE%E9%A2%98"><span class="toc-number">5.4.3.</span> <span class="toc-text">大型模式问题</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">6.</span> <span class="toc-text">小结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">7.</span> <span class="toc-text">参考资料</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%BE%E5%90%8E%E6%80%9D%E8%80%83"><span class="toc-number">8.</span> <span class="toc-text">课后思考</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/04/09/%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86/Go%20JSON%20%E5%BA%93%E8%B0%83%E7%A0%94/" title="Go JSON 库调研"><img src="https://cdn.processon.com/643289818976261088dae76b?e=1681037201&amp;token=trhI0BY8QfVrIGn9nENop6JAc6l5nZuxhjQ62UfM:7_9-iyaq39lLvAlJyPfFSQBbXxQ=" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Go JSON 库调研"/></a><div class="content"><a class="title" href="/2023/04/09/%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86/Go%20JSON%20%E5%BA%93%E8%B0%83%E7%A0%94/" title="Go JSON 库调研">Go JSON 库调研</a><time datetime="2023-04-08T16:00:00.000Z" title="发表于 2023-04-09 00:00:00">2023-04-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/02/02/%E6%95%88%E7%8E%87%E5%B7%A5%E5%85%B7/Copilot/" title="copilot 使用指南"><img src="https://cdn.processon.com/643428cf8976261088db0164?e=1681143519&amp;token=trhI0BY8QfVrIGn9nENop6JAc6l5nZuxhjQ62UfM:7JpU2MUkcaXceDC5D_0dJH47My8=" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="copilot 使用指南"/></a><div class="content"><a class="title" href="/2023/02/02/%E6%95%88%E7%8E%87%E5%B7%A5%E5%85%B7/Copilot/" title="copilot 使用指南">copilot 使用指南</a><time datetime="2023-02-01T16:00:00.000Z" title="发表于 2023-02-02 00:00:00">2023-02-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/12/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/%E8%AE%BE%E8%AE%A1%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/" title="设计分布式锁"><img src="http://cdn.processon.com/64342cb300cee00eb1ae9320?e=1681144516&amp;token=trhI0BY8QfVrIGn9nENop6JAc6l5nZuxhjQ62UfM:hCILVNM50U_37-rCrlSFJ8n9ZsA=" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="设计分布式锁"/></a><div class="content"><a class="title" href="/2022/11/12/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/%E8%AE%BE%E8%AE%A1%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/" title="设计分布式锁">设计分布式锁</a><time datetime="2022-11-11T16:00:00.000Z" title="发表于 2022-11-12 00:00:00">2022-11-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/08/20/%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/zsh%20%E7%B2%98%E8%B4%B4%E6%85%A2%E9%97%AE%E9%A2%98/" title="zsh 粘贴慢问题"><img src="http://cdn.processon.com/64342e1f00cee00eb1ae9339?e=1681144880&amp;token=trhI0BY8QfVrIGn9nENop6JAc6l5nZuxhjQ62UfM:Yb1TK164sPDpqBHoo0yHYaZtuO0=" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="zsh 粘贴慢问题"/></a><div class="content"><a class="title" href="/2022/08/20/%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/zsh%20%E7%B2%98%E8%B4%B4%E6%85%A2%E9%97%AE%E9%A2%98/" title="zsh 粘贴慢问题">zsh 粘贴慢问题</a><time datetime="2022-08-19T16:00:00.000Z" title="发表于 2022-08-20 00:00:00">2022-08-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/06/21/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/GO%E4%BB%A3%E7%A0%81%E9%A3%8E%E6%A0%BC%E6%80%BB%E7%BB%93%EF%BC%88%E7%A7%81%E8%97%8F%EF%BC%89/" title="代码风格规范"><img src="http://cdn.processon.com/64342a4fe6c7164a487420a6?e=1681143904&amp;token=trhI0BY8QfVrIGn9nENop6JAc6l5nZuxhjQ62UfM:nE2v8C7oqNs0bPGFUBTxuJ8S6k4=" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="代码风格规范"/></a><div class="content"><a class="title" href="/2022/06/21/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/GO%E4%BB%A3%E7%A0%81%E9%A3%8E%E6%A0%BC%E6%80%BB%E7%BB%93%EF%BC%88%E7%A7%81%E8%97%8F%EF%BC%89/" title="代码风格规范">代码风格规范</a><time datetime="2022-06-20T16:00:00.000Z" title="发表于 2022-06-21 00:00:00">2022-06-21</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2023 By Golden</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>